
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Because using satellite data shouldn't be rocket science, neither in code nor in hardware. .">
      
      
        <meta name="author" content="Mateus Pinto da Silva">
      
      
        <link rel="canonical" href="https://mateuspinto.github.io/agrigee_lite/modules/">
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Modules - agrigee_lite</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agrigee_lite" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="agrigee_lite" class="md-header__button md-logo" aria-label="agrigee_lite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            agrigee_lite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mateuspinto/AgriGEE.lite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mateuspinto/AgriGEE.lite
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="agrigee_lite" class="md-nav__button md-logo" aria-label="agrigee_lite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    agrigee_lite
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mateuspinto/AgriGEE.lite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    mateuspinto/AgriGEE.lite
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite" class="md-nav__link">
    <span class="md-ellipsis">
      agrigee_lite
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.ee_quick_start" class="md-nav__link">
    <span class="md-ellipsis">
      ee_quick_start
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get_all_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.quadtree_clustering" class="md-nav__link">
    <span class="md-ellipsis">
      quadtree_clustering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.random_points_from_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      random_points_from_gdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.images" class="md-nav__link">
    <span class="md-ellipsis">
      images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits_gcs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits_gdrive" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits_gdrive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat" class="md-nav__link">
    <span class="md-ellipsis">
      sat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ANADEM" class="md-nav__link">
    <span class="md-ellipsis">
      ANADEM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat5" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat5
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat7" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat7
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat8" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat8
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat9" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.MapBiomas" class="md-nav__link">
    <span class="md-ellipsis">
      MapBiomas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Modis8Days" class="md-nav__link">
    <span class="md-ellipsis">
      Modis8Days
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modis8Days">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Modis8Days._mask_modis8days_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_modis8days_clouds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily" class="md-nav__link">
    <span class="md-ellipsis">
      ModisDaily
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ModisDaily">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily._mask_modis_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_modis_clouds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily.imageCollection" class="md-nav__link">
    <span class="md-ellipsis">
      imageCollection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.PALSAR2ScanSAR" class="md-nav__link">
    <span class="md-ellipsis">
      PALSAR2ScanSAR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PALSAR2ScanSAR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.PALSAR2ScanSAR._mask_quality" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_quality
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.SatelliteEmbedding" class="md-nav__link">
    <span class="md-ellipsis">
      SatelliteEmbedding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel1GRD" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel1GRD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sentinel1GRD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel1GRD._mask_edge" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_edge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel2" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.TwoSatelliteFusion" class="md-nav__link">
    <span class="md-ellipsis">
      TwoSatelliteFusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.vis" class="md-nav__link">
    <span class="md-ellipsis">
      vis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.vis.multiple_sits" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite" class="md-nav__link">
    <span class="md-ellipsis">
      agrigee_lite
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.ee_quick_start" class="md-nav__link">
    <span class="md-ellipsis">
      ee_quick_start
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get_all_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.quadtree_clustering" class="md-nav__link">
    <span class="md-ellipsis">
      quadtree_clustering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.random_points_from_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      random_points_from_gdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.images" class="md-nav__link">
    <span class="md-ellipsis">
      images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits_gcs" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits_gcs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.get.multiple_sits_gdrive" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits_gdrive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat" class="md-nav__link">
    <span class="md-ellipsis">
      sat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ANADEM" class="md-nav__link">
    <span class="md-ellipsis">
      ANADEM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat5" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat5
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat7" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat7
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat8" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat8
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Landsat9" class="md-nav__link">
    <span class="md-ellipsis">
      Landsat9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.MapBiomas" class="md-nav__link">
    <span class="md-ellipsis">
      MapBiomas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Modis8Days" class="md-nav__link">
    <span class="md-ellipsis">
      Modis8Days
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modis8Days">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Modis8Days._mask_modis8days_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_modis8days_clouds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily" class="md-nav__link">
    <span class="md-ellipsis">
      ModisDaily
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ModisDaily">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily._mask_modis_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_modis_clouds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.ModisDaily.imageCollection" class="md-nav__link">
    <span class="md-ellipsis">
      imageCollection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.PALSAR2ScanSAR" class="md-nav__link">
    <span class="md-ellipsis">
      PALSAR2ScanSAR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PALSAR2ScanSAR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.PALSAR2ScanSAR._mask_quality" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_quality
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.SatelliteEmbedding" class="md-nav__link">
    <span class="md-ellipsis">
      SatelliteEmbedding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel1GRD" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel1GRD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sentinel1GRD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel1GRD._mask_edge" class="md-nav__link">
    <span class="md-ellipsis">
      _mask_edge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.Sentinel2" class="md-nav__link">
    <span class="md-ellipsis">
      Sentinel2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.sat.TwoSatelliteFusion" class="md-nav__link">
    <span class="md-ellipsis">
      TwoSatelliteFusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.vis" class="md-nav__link">
    <span class="md-ellipsis">
      vis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agrigee_lite.vis.multiple_sits" class="md-nav__link">
    <span class="md-ellipsis">
      multiple_sits
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Modules</h1>

<div class="doc doc-object doc-module">



<a id="agrigee_lite"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.ee_quick_start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ee_quick_start</span><span class="p">()</span></code>

<a href="#agrigee_lite.ee_quick_start" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Quick start function to initialize Earth Engine with automatic credential detection.</p>
<p>Automatically detects and uses Earth Engine credentials from the GEE_KEY
environment variable. Supports both service account JSON files and project
tokens, providing informative feedback about the initialization process.</p>


<details class="environment-variables" open>
  <summary>Environment Variables</summary>
  <p>GEE_KEY : str
    Earth Engine authentication key. Can be either:
    - Path to service account JSON file (ends with .json)
    - Project token string for standard authentication</p>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prints initialization status messages but doesn't return values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GEE_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/path/to/service-account.json&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ee_quick_start</span><span class="p">()</span>
<span class="go">Earth Engine initialized successfully using AgriGEE.lite...</span>
</code></pre></div>


<details class="note" open>
  <summary>Notes</summary>
  <p>For service account authentication, the function also sets the
GOOGLE_APPLICATION_CREDENTIALS environment variable for use Google Cloud Storage.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>agrigee_lite/ee_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ee_quick_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick start function to initialize Earth Engine with automatic credential detection.</span>

<span class="sd">    Automatically detects and uses Earth Engine credentials from the GEE_KEY</span>
<span class="sd">    environment variable. Supports both service account JSON files and project</span>
<span class="sd">    tokens, providing informative feedback about the initialization process.</span>

<span class="sd">    Environment Variables</span>
<span class="sd">    ---------------------</span>
<span class="sd">    GEE_KEY : str</span>
<span class="sd">        Earth Engine authentication key. Can be either:</span>
<span class="sd">        - Path to service account JSON file (ends with .json)</span>
<span class="sd">        - Project token string for standard authentication</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Prints initialization status messages but doesn&#39;t return values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; os.environ[&#39;GEE_KEY&#39;] = &#39;/path/to/service-account.json&#39;</span>
<span class="sd">    &gt;&gt;&gt; ee_quick_start()</span>
<span class="sd">    Earth Engine initialized successfully using AgriGEE.lite...</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For service account authentication, the function also sets the</span>
<span class="sd">    GOOGLE_APPLICATION_CREDENTIALS environment variable for use Google Cloud Storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ee_is_authenticated</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;GEE_KEY&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">gee_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GEE_KEY&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">gee_key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>  <span class="c1"># with service account</span>
                <span class="n">credentials</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ServiceAccountCredentials</span><span class="p">(</span><span class="n">gee_key</span><span class="p">,</span> <span class="n">gee_key</span><span class="p">)</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gee_key</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gee_key</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">key_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Earth Engine initialized successfully using AgriGEE.lite with service account. Project: </span><span class="si">{</span><span class="n">key_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;project_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, Email: </span><span class="si">{</span><span class="n">key_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;client_email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># using token</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">opt_url</span><span class="o">=</span><span class="s2">&quot;https://earthengine-highvolume.googleapis.com&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">gee_key</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earth Engine initialized successfully using AgriGEE.lite using token (project=</span><span class="si">{</span><span class="n">gee_key</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Earth Engine not initialized. Please set the GEE_KEY environment variable to your Earth Engine key. You can find more information in the AgriGEE.lite documentation.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.get_all_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_tasks</span><span class="p">()</span></code>

<a href="#agrigee_lite.get_all_tasks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Retrieve status information for all Earth Engine tasks.</p>
<p>Fetches comprehensive information about all Earth Engine operations/tasks
associated with the authenticated account, including metadata, timing,
resource usage, and cost estimates.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing task information with the following columns:
- attempt: Task attempt number
- create_time: Task creation timestamp
- description: Task description/name
- destination_uris: Output destination URIs
- done: Boolean indicating completion status
- end_time: Task completion timestamp
- name: Internal task name
- priority: Task priority level
- progress: Completion progress (0.0 to 1.0)
- script_uri: Source script URI
- start_time: Task start timestamp
- state: Current task state (RUNNING, COMPLETED, FAILED, etc.)
- total_batch_eecu_usage_seconds: Total EECU usage in seconds
- type: Task type (EXPORT_IMAGE, EXPORT_TABLE, etc.)
- update_time: Last update timestamp
- estimated_cost_usd_tier_1: Estimated cost in US Dollars for Tier 1 pricing
- estimated_cost_usd_tier_2: Estimated cost in US Dollars for Tier 2 pricing
- estimated_cost_usd_tier_3: Estimated cost in US Dollars for Tier 3 pricing</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Cost estimates are based on EECU usage and standard pricing tiers.
If no tasks exist, returns an empty DataFrame with the same column structure.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>agrigee_lite/ee_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ee_get_tasks_status</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve status information for all Earth Engine tasks.</span>

<span class="sd">    Fetches comprehensive information about all Earth Engine operations/tasks</span>
<span class="sd">    associated with the authenticated account, including metadata, timing,</span>
<span class="sd">    resource usage, and cost estimates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        DataFrame containing task information with the following columns:</span>
<span class="sd">        - attempt: Task attempt number</span>
<span class="sd">        - create_time: Task creation timestamp</span>
<span class="sd">        - description: Task description/name</span>
<span class="sd">        - destination_uris: Output destination URIs</span>
<span class="sd">        - done: Boolean indicating completion status</span>
<span class="sd">        - end_time: Task completion timestamp</span>
<span class="sd">        - name: Internal task name</span>
<span class="sd">        - priority: Task priority level</span>
<span class="sd">        - progress: Completion progress (0.0 to 1.0)</span>
<span class="sd">        - script_uri: Source script URI</span>
<span class="sd">        - start_time: Task start timestamp</span>
<span class="sd">        - state: Current task state (RUNNING, COMPLETED, FAILED, etc.)</span>
<span class="sd">        - total_batch_eecu_usage_seconds: Total EECU usage in seconds</span>
<span class="sd">        - type: Task type (EXPORT_IMAGE, EXPORT_TABLE, etc.)</span>
<span class="sd">        - update_time: Last update timestamp</span>
<span class="sd">        - estimated_cost_usd_tier_1: Estimated cost in US Dollars for Tier 1 pricing</span>
<span class="sd">        - estimated_cost_usd_tier_2: Estimated cost in US Dollars for Tier 2 pricing</span>
<span class="sd">        - estimated_cost_usd_tier_3: Estimated cost in US Dollars for Tier 3 pricing</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Cost estimates are based on EECU usage and standard pricing tiers.</span>
<span class="sd">    If no tasks exist, returns an empty DataFrame with the same column structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">listOperations</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>

            <span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;attempt&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attempt&quot;</span><span class="p">),</span>
                <span class="s2">&quot;create_time&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;createTime&quot;</span><span class="p">),</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                <span class="s2">&quot;destination_uris&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;destinationUris&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;done&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">),</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;endTime&quot;</span><span class="p">),</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span>
                <span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">),</span>
                <span class="s2">&quot;script_uri&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scriptUri&quot;</span><span class="p">),</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;startTime&quot;</span><span class="p">),</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">),</span>
                <span class="s2">&quot;total_batch_eecu_usage_seconds&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batchEecuUsageSeconds&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                <span class="s2">&quot;update_time&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updateTime&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;create_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">create_time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mixed&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mixed&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mixed&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;update_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">update_time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mixed&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;estimated_cost_usd_tier_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">total_batch_eecu_usage_seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.40</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;estimated_cost_usd_tier_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">total_batch_eecu_usage_seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.28</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;estimated_cost_usd_tier_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">total_batch_eecu_usage_seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.16</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># If no tasks are found, create an empty DataFrame with the same columns</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;attempt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;create_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                <span class="s2">&quot;destination_uris&quot;</span><span class="p">,</span>
                <span class="s2">&quot;done&quot;</span><span class="p">,</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;priority&quot;</span><span class="p">,</span>
                <span class="s2">&quot;progress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;script_uri&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;state&quot;</span><span class="p">,</span>
                <span class="s2">&quot;total_batch_eecu_usage_seconds&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">,</span>
                <span class="s2">&quot;update_time&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.quadtree_clustering" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">quadtree_clustering</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

<a href="#agrigee_lite.quadtree_clustering" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Cluster geometries in a GeoDataFrame using a quadtree and simplify clusters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing geometries (Polygon, MultiPolygon, or Point).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of geometries per cluster (default is 1000).</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame with cluster labels and simplified geometries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/misc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">quadtree_clustering</span><span class="p">(</span><span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cluster geometries in a GeoDataFrame using a quadtree and simplify clusters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing geometries (Polygon, MultiPolygon, or Point).</span>
<span class="sd">    max_size : int, optional</span>
<span class="sd">        Maximum number of geometries per cluster (default is 1000).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame with cluster labels and simplified geometries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Centroid columns (ignore CRS warning)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;centroid_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span>
        <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;centroid_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span>

    <span class="c1"># Build quadtree and label clusters</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="n">build_quadtree_iterative</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">)</span>

    <span class="n">cluster_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_indexes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
        <span class="n">cluster_array</span><span class="p">[</span><span class="n">cluster_indexes</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_array</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span> <span class="s2">&quot;centroid_x&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">unique_cluster_ids</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_simplify_cluster</span><span class="p">,</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">][[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]],</span> <span class="n">cluster_id</span><span class="p">):</span> <span class="n">cluster_id</span>
            <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">unique_cluster_ids</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">),</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">),</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simplifying clusters&quot;</span><span class="p">,</span>
            <span class="n">smoothing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">cluster_id</span><span class="p">,</span> <span class="n">simplified_geom</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplified_geom</span><span class="o">.</span><span class="n">values</span>

    <span class="k">return</span> <span class="n">gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.random_points_from_gdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">random_points_from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">num_points_per_geometry</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#agrigee_lite.random_points_from_gdf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate random points from geometries in a GeoDataFrame, with optional buffering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing geometries (Polygon, MultiPolygon, or Point).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_points_per_geometry</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of points to generate per geometry (default is 10).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buffer</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Buffer distance to apply to geometries before generating points (default is -10).</p>
              </div>
            </td>
            <td>
                  <code>-10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame of generated points merged with original attributes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/misc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">random_points_from_gdf</span><span class="p">(</span>
    <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">num_points_per_geometry</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate random points from geometries in a GeoDataFrame, with optional buffering.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing geometries (Polygon, MultiPolygon, or Point).</span>
<span class="sd">    num_points_per_geometry : int, optional</span>
<span class="sd">        Number of points to generate per geometry (default is 10).</span>
<span class="sd">    buffer : int, optional</span>
<span class="sd">        Buffer distance to apply to geometries before generating points (default is -10).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of generated points merged with original attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">buffer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">quadtree_clustering</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
        <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">estimate_utm_crs</span><span class="p">())</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">generate_grid_random_points_from_gdf</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">num_points_per_geometry</span><span class="p">)</span>
    <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;original_index&quot;</span><span class="p">}),</span>
        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;geometry_id&quot;</span><span class="p">,</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="p">[</span><span class="n">points_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">points_gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="agrigee_lite.get"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.get.images" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">images</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">invalid_images_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_parallel_downloads</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">force_redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#agrigee_lite.get.images" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Download multiple satellite images for a given geometry and date range.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="shapely.Polygon">Polygon</span> or <span title="shapely.MultiPolygon">MultiPolygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The area of interest as a shapely Polygon or MultiPolygon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span> or <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for image collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span> or <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for image collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.AbstractSatellite">AbstractSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The satellite configuration to use for image collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>invalid_images_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold for filtering images based on valid pixels (0.0-1.0), by default 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_parallel_downloads</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of parallel downloads, by default 40.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_redownload</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force re-download of existing files, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_indices</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>] or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of specific image indices to download (e.g., [0, 1] for first two images).
If None, all images in the date range will be downloaded, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of image names (dates in YYYY-MM-DD format) that were downloaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/get/image.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_images</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="n">geometry</span><span class="p">:</span> <span class="n">Polygon</span> <span class="o">|</span> <span class="n">MultiPolygon</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
    <span class="n">invalid_images_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">max_parallel_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">force_redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">image_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download multiple satellite images for a given geometry and date range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : Polygon or MultiPolygon</span>
<span class="sd">        The area of interest as a shapely Polygon or MultiPolygon.</span>
<span class="sd">    start_date : pd.Timestamp or str</span>
<span class="sd">        Start date for image collection.</span>
<span class="sd">    end_date : pd.Timestamp or str</span>
<span class="sd">        End date for image collection.</span>
<span class="sd">    satellite : AbstractSatellite</span>
<span class="sd">        The satellite configuration to use for image collection.</span>
<span class="sd">    invalid_images_threshold : float, optional</span>
<span class="sd">        Threshold for filtering images based on valid pixels (0.0-1.0), by default 0.5.</span>
<span class="sd">    max_parallel_downloads : int, optional</span>
<span class="sd">        Maximum number of parallel downloads, by default 40.</span>
<span class="sd">    force_redownload : bool, optional</span>
<span class="sd">        Whether to force re-download of existing files, by default False.</span>
<span class="sd">    image_indices : list[int] or None, optional</span>
<span class="sd">        List of specific image indices to download (e.g., [0, 1] for first two images).</span>
<span class="sd">        If None, all images in the date range will be downloaded, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of image names (dates in YYYY-MM-DD format) that were downloaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="k">else</span> <span class="n">start_date</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="k">else</span> <span class="n">end_date</span>

    <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">__geo_interface__</span><span class="p">)</span>
    <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span>
        <span class="n">ee_geometry</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">ee_expression</span> <span class="o">=</span> <span class="n">satellite</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

    <span class="n">metadata_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">log_dict_function_call_summary</span><span class="p">([</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;satellite&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_parallel_downloads&quot;</span><span class="p">,</span>
        <span class="s2">&quot;force_redownload&quot;</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">satellite</span><span class="o">.</span><span class="n">log_dict</span><span class="p">()</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;centroid_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;centroid_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span>

    <span class="k">if</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No images found for the specified parameters.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="p">[]</span>

    <span class="n">max_valid_pixels</span> <span class="o">=</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">aggregate_max</span><span class="p">(</span><span class="s2">&quot;ZZ_USER_VALID_PIXELS&quot;</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">max_valid_pixels</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">invalid_images_threshold</span><span class="p">)</span>
    <span class="n">ee_expression</span> <span class="o">=</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="s2">&quot;ZZ_USER_VALID_PIXELS&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span>

    <span class="n">image_names</span> <span class="o">=</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="s2">&quot;ZZ_USER_TIME_DUMMY&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
    <span class="n">image_indexes</span> <span class="o">=</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="s2">&quot;system:index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

    <span class="c1"># Filter images by indices if provided</span>
    <span class="k">if</span> <span class="n">image_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Ensure indices are valid</span>
        <span class="n">valid_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">image_indices</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_indexes</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_indices</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid image indices provided.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="p">[]</span>

        <span class="n">image_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">valid_indices</span><span class="p">]</span>
        <span class="n">image_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">valid_indices</span><span class="p">]</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/temp/images&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_dict_hash</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">force_redownload</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.zip&quot;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="n">downloader</span> <span class="o">=</span> <span class="n">DownloaderStrategy</span><span class="p">(</span><span class="n">download_folder</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>

    <span class="n">already_downloaded_files</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.zip&quot;</span><span class="p">)}</span>
    <span class="n">all_chunks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_indexes</span><span class="p">)))</span>
    <span class="n">pending_chunks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_chunks</span> <span class="o">-</span> <span class="n">already_downloaded_files</span><span class="p">)</span>

    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pending_chunks</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Downloading images (</span><span class="si">{</span><span class="n">output_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_pbar</span><span class="p">():</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_completed_downloads</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span>
            <span class="s2">&quot;aria2_errors&quot;</span><span class="p">:</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_downloads_with_error</span><span class="p">,</span>
            <span class="s2">&quot;active_downloads&quot;</span><span class="p">:</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_unfinished_downloads</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_task</span><span class="p">(</span><span class="n">chunk_index</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ee_expression</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;system:index&quot;</span><span class="p">,</span> <span class="n">image_indexes</span><span class="p">[</span><span class="n">chunk_index</span><span class="p">]))</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
            <span class="c1"># Use only the image date as filename (GEE standard format)</span>
            <span class="n">image_date</span> <span class="o">=</span> <span class="n">image_names</span><span class="p">[</span><span class="n">chunk_index</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_date</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">getDownloadURL</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">ee_geometry</span><span class="p">})</span>
            <span class="n">downloader</span><span class="o">.</span><span class="n">add_download</span><span class="p">([(</span><span class="n">chunk_index</span><span class="p">,</span> <span class="n">url</span><span class="p">)])</span>
            <span class="k">return</span> <span class="n">chunk_index</span><span class="p">,</span> <span class="kc">True</span>  <span class="c1"># noqa: TRY300</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chunk_index</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_completed_downloads</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_chunks</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_parallel_downloads</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">download_task</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span> <span class="n">chunk</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pending_chunks</span><span class="p">}</span>

            <span class="n">failed_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                <span class="n">chunk</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                    <span class="n">failed_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download images - </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2"> - Failed to initiate download for chunk </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

                <span class="n">update_pbar</span><span class="p">()</span>

                <span class="k">while</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_unfinished_downloads</span> <span class="o">&gt;=</span> <span class="n">max_parallel_downloads</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">update_pbar</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_unfinished_downloads</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">update_pbar</span><span class="p">()</span>

        <span class="n">pending_chunks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">failed_chunks</span> <span class="o">+</span> <span class="n">downloader</span><span class="o">.</span><span class="n">failed_downloads</span><span class="p">))</span>

    <span class="n">update_pbar</span><span class="p">()</span>
    <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">image_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.get.multiple_sits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multiple_sits</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="o">=</span><span class="s1">&#39;original_index&#39;</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="o">=</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="n">end_date_column_name</span><span class="o">=</span><span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_parallel_downloads</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">force_redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#agrigee_lite.get.multiple_sits" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Download satellite time series for multiple geometries using parallel processing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing geometries and temporal information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.AbstractSatellite">AbstractSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reducers</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>] or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of reducer names to apply, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_index_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column to store original indices, by default "original_index".</p>
              </div>
            </td>
            <td>
                  <code>&#39;original_index&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the start date column, by default "start_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;start_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the end date column, by default "end_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;end_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsampling_max_pixels</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of features to process per chunk, by default 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_parallel_downloads</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of parallel downloads, by default 40.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_redownload</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force re-download of existing data, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined DataFrame containing satellite time series for all geometries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/get/sits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_sits</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
    <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">original_index_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original_index&quot;</span><span class="p">,</span>
    <span class="n">start_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
    <span class="n">end_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
    <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1_000</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_parallel_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">force_redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download satellite time series for multiple geometries using parallel processing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : gpd.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing geometries and temporal information.</span>
<span class="sd">    satellite : AbstractSatellite</span>
<span class="sd">        Satellite configuration object.</span>
<span class="sd">    reducers : set[str] or None, optional</span>
<span class="sd">        Set of reducer names to apply, by default None.</span>
<span class="sd">    original_index_column_name : str, optional</span>
<span class="sd">        Name of the column to store original indices, by default &quot;original_index&quot;.</span>
<span class="sd">    start_date_column_name : str, optional</span>
<span class="sd">        Name of the start date column, by default &quot;start_date&quot;.</span>
<span class="sd">    end_date_column_name : str, optional</span>
<span class="sd">        Name of the end date column, by default &quot;end_date&quot;.</span>
<span class="sd">    subsampling_max_pixels : float, optional</span>
<span class="sd">        Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</span>
<span class="sd">    chunksize : int, optional</span>
<span class="sd">        Number of features to process per chunk, by default 10.</span>
<span class="sd">    max_parallel_downloads : int, optional</span>
<span class="sd">        Maximum number of parallel downloads, by default 40.</span>
<span class="sd">    force_redownload : bool, optional</span>
<span class="sd">        Whether to force re-download of existing data, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Combined DataFrame containing satellite time series for all geometries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">sanitize_and_prepare_input_gdf</span><span class="p">(</span>
        <span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="p">,</span> <span class="n">end_date_column_name</span>
    <span class="p">)</span>

    <span class="n">metadata_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">log_dict_function_call_summary</span><span class="p">([</span><span class="s2">&quot;gdf&quot;</span><span class="p">,</span> <span class="s2">&quot;satellite&quot;</span><span class="p">,</span> <span class="s2">&quot;max_parallel_downloads&quot;</span><span class="p">,</span> <span class="s2">&quot;force_redownload&quot;</span><span class="p">])</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">satellite</span><span class="o">.</span><span class="n">log_dict</span><span class="p">()</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/temp/sits&quot;</span><span class="p">)</span>
        <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_gdf_hash</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span><span class="w"> </span><span class="n">start_date_column_name</span><span class="p">,</span><span class="w"> </span><span class="n">end_date_column_name</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">create_dict_hash</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">force_redownload</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">downloader</span> <span class="o">=</span> <span class="n">DownloaderStrategy</span><span class="p">(</span><span class="n">download_folder</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>

    <span class="n">num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span> <span class="o">+</span> <span class="n">chunksize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">chunksize</span>

    <span class="n">already_downloaded_files</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">)]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">already_downloaded_files</span><span class="p">),</span> <span class="s2">&quot;chunks already downloaded and will be skipped.&quot;</span><span class="p">)</span>
    <span class="n">initial_download_chunks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_chunks</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">already_downloaded_files</span><span class="p">))</span>

    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_download_chunks</span><span class="p">)</span> <span class="o">*</span> <span class="n">chunksize</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Building download URLs (</span><span class="si">{</span><span class="n">output_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span>
        <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_pbar</span><span class="p">():</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_completed_downloads</span> <span class="o">*</span> <span class="n">chunksize</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span>
            <span class="s2">&quot;not_sent_to_server&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_sent_to_server</span><span class="p">),</span>
            <span class="s2">&quot;aria2_errors&quot;</span><span class="p">:</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_downloads_with_error</span><span class="p">,</span>
            <span class="s2">&quot;active_downloads&quot;</span><span class="p">:</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_unfinished_downloads</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="n">to_download_chunks</span> <span class="o">=</span> <span class="n">initial_download_chunks</span>
    <span class="k">while</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_completed_downloads</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_download_chunks</span><span class="p">):</span>
        <span class="n">not_sent_to_server</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">current_chunk</span> <span class="ow">in</span> <span class="n">to_download_chunks</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">downloader</span><span class="o">.</span><span class="n">num_unfinished_downloads</span> <span class="o">&gt;=</span> <span class="n">max_parallel_downloads</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">update_pbar</span><span class="p">()</span>

            <span class="n">sub</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">current_chunk</span> <span class="o">*</span> <span class="n">chunksize</span> <span class="p">:</span> <span class="p">(</span><span class="n">current_chunk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chunksize</span><span class="p">]</span>
            <span class="n">ee_expression</span> <span class="o">=</span> <span class="n">build_ee_expression</span><span class="p">(</span>
                <span class="n">sub</span><span class="p">,</span>
                <span class="n">satellite</span><span class="p">,</span>
                <span class="n">reducers</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">original_index_column_name</span><span class="p">,</span>
                <span class="n">start_date_column_name</span><span class="p">,</span>
                <span class="n">end_date_column_name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">ee_expression</span><span class="o">.</span><span class="n">getDownloadURL</span><span class="p">(</span>
                    <span class="n">filetype</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span>
                    <span class="n">selectors</span><span class="o">=</span><span class="n">build_selectors</span><span class="p">(</span><span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="p">),</span>
                    <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">downloader</span><span class="o">.</span><span class="n">add_download</span><span class="p">([(</span><span class="n">current_chunk</span><span class="p">,</span> <span class="n">url</span><span class="p">)])</span>

            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">raise</span>

            <span class="k">except</span> <span class="n">ee</span><span class="o">.</span><span class="n">ee_exception</span><span class="o">.</span><span class="n">EEException</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;- Chunk id =&quot;</span><span class="p">,</span> <span class="n">current_chunk</span><span class="p">,</span> <span class="s2">&quot; - Failed to get download URL.&quot;</span><span class="p">)</span>
                <span class="n">not_sent_to_server</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span>

            <span class="n">update_pbar</span><span class="p">()</span>

        <span class="n">to_download_chunks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">not_sent_to_server</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">failed_downloads</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_download_chunks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">num_completed_downloads</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_download_chunks</span><span class="p">)):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">to_download_chunks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">not_sent_to_server</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">failed_downloads</span><span class="p">))</span>
            <span class="n">update_pbar</span><span class="p">()</span>

    <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">whole_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">whole_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">whole_result_df</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">whole_result_df</span> <span class="o">=</span> <span class="n">prepare_output_df</span><span class="p">(</span><span class="n">whole_result_df</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">whole_result_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.get.multiple_sits_gcs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multiple_sits_gcs</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">reducers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="o">=</span><span class="s1">&#39;original_index&#39;</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="o">=</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="n">end_date_column_name</span><span class="o">=</span><span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">force_redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#agrigee_lite.get.multiple_sits_gcs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Download satellite time series using Google Earth Engine tasks to Google Cloud Storage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing geometries and temporal information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.AbstractSatellite">AbstractSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bucket_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Cloud Storage bucket name for exports.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reducers</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>] or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of reducer names to apply, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_index_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column to store original indices, by default "original_index".</p>
              </div>
            </td>
            <td>
                  <code>&#39;original_index&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the start date column, by default "start_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;start_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the end date column, by default "end_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;end_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsampling_max_pixels</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum cluster size for spatial grouping, by default 500.</p>
              </div>
            </td>
            <td>
                  <code>500</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_redownload</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force re-download of existing data, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to wait for task completion, by default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None or <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If wait is True, returns DataFrame with combined results.
If wait is False, returns None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/get/sits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_sits_chunks_gcs</span><span class="p">(</span>
    <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">original_index_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original_index&quot;</span><span class="p">,</span>
    <span class="n">start_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
    <span class="n">end_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
    <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1_000</span><span class="p">,</span>
    <span class="n">cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">force_redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download satellite time series using Google Earth Engine tasks to Google Cloud Storage.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : gpd.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing geometries and temporal information.</span>
<span class="sd">    satellite : AbstractSatellite</span>
<span class="sd">        Satellite configuration object.</span>
<span class="sd">    bucket_name : str</span>
<span class="sd">        Google Cloud Storage bucket name for exports.</span>
<span class="sd">    reducers : set[str] or None, optional</span>
<span class="sd">        Set of reducer names to apply, by default None.</span>
<span class="sd">    original_index_column_name : str, optional</span>
<span class="sd">        Name of the column to store original indices, by default &quot;original_index&quot;.</span>
<span class="sd">    start_date_column_name : str, optional</span>
<span class="sd">        Name of the start date column, by default &quot;start_date&quot;.</span>
<span class="sd">    end_date_column_name : str, optional</span>
<span class="sd">        Name of the end date column, by default &quot;end_date&quot;.</span>
<span class="sd">    subsampling_max_pixels : float, optional</span>
<span class="sd">        Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</span>
<span class="sd">    cluster_size : int, optional</span>
<span class="sd">        Maximum cluster size for spatial grouping, by default 500.</span>
<span class="sd">    force_redownload : bool, optional</span>
<span class="sd">        Whether to force re-download of existing data, by default False.</span>
<span class="sd">    wait : bool, optional</span>
<span class="sd">        Whether to wait for task completion, by default True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None or pd.DataFrame</span>
<span class="sd">        If wait is True, returns DataFrame with combined results.</span>
<span class="sd">        If wait is False, returns None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">smart_open</span><span class="w"> </span><span class="kn">import</span> <span class="nb">open</span>  <span class="c1"># noqa: A004</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Empty GeoDataFrame, nothing to download&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_sits_task_gcs</span><span class="p">(</span>
        <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
        <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">original_index_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original_index&quot;</span><span class="p">,</span>
        <span class="n">start_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
        <span class="n">end_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1_000</span><span class="p">,</span>
        <span class="n">taskname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Task</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Google Earth Engine export task to Google Cloud Storage.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gdf : gpd.GeoDataFrame</span>
<span class="sd">            GeoDataFrame containing geometries and temporal information.</span>
<span class="sd">        satellite : AbstractSatellite</span>
<span class="sd">            Satellite configuration object.</span>
<span class="sd">        bucket_name : str</span>
<span class="sd">            Google Cloud Storage bucket name.</span>
<span class="sd">        file_path : str</span>
<span class="sd">            File path within the bucket for the exported file.</span>
<span class="sd">        reducers : set[str] or None, optional</span>
<span class="sd">            Set of reducer names to apply, by default None.</span>
<span class="sd">        original_index_column_name : str, optional</span>
<span class="sd">            Name of the column to store original indices, by default &quot;original_index&quot;.</span>
<span class="sd">        start_date_column_name : str, optional</span>
<span class="sd">            Name of the start date column, by default &quot;start_date&quot;.</span>
<span class="sd">        end_date_column_name : str, optional</span>
<span class="sd">            Name of the end date column, by default &quot;end_date&quot;.</span>
<span class="sd">        subsampling_max_pixels : float, optional</span>
<span class="sd">            Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</span>
<span class="sd">        taskname : str, optional</span>
<span class="sd">            Custom task name, by default &quot;&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ee.batch.Task</span>
<span class="sd">            Earth Engine export task object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">taskname</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">taskname</span> <span class="o">=</span> <span class="n">file_path</span>

        <span class="n">ee_expression</span> <span class="o">=</span> <span class="n">build_ee_expression</span><span class="p">(</span>
            <span class="n">gdf</span><span class="p">,</span>
            <span class="n">satellite</span><span class="p">,</span>
            <span class="n">reducers</span><span class="p">,</span>
            <span class="n">subsampling_max_pixels</span><span class="p">,</span>
            <span class="n">original_index_column_name</span><span class="p">,</span>
            <span class="n">start_date_column_name</span><span class="p">,</span>
            <span class="n">end_date_column_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Export</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">toCloudStorage</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">ee_expression</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">taskname</span><span class="p">,</span>
            <span class="n">fileFormat</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">,</span>
            <span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">selectors</span><span class="o">=</span><span class="n">build_selectors</span><span class="p">(</span><span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">task</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">sanitize_and_prepare_input_gdf</span><span class="p">(</span>
        <span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="p">,</span> <span class="n">end_date_column_name</span>
    <span class="p">)</span>

    <span class="n">task_mgr</span> <span class="o">=</span> <span class="n">GEETaskManager</span><span class="p">()</span>
    <span class="n">tasks_df</span> <span class="o">=</span> <span class="n">ee_get_tasks_status</span><span class="p">()</span>
    <span class="n">tasks_df</span> <span class="o">=</span> <span class="n">tasks_df</span><span class="p">[</span><span class="n">tasks_df</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;agl_&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">completed_or_running_tasks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">tasks_df</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># The task is the same, no matter who started it</span>

    <span class="n">username</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">hashname</span> <span class="o">=</span> <span class="n">create_gdf_hash</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="p">,</span> <span class="n">end_date_column_name</span><span class="p">)</span>

    <span class="n">gcs_save_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;agl/</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">metadata_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">log_dict_function_call_summary</span><span class="p">([</span><span class="s2">&quot;gdf&quot;</span><span class="p">,</span> <span class="s2">&quot;satellite&quot;</span><span class="p">])</span>
    <span class="n">metadata_dict</span> <span class="o">|=</span> <span class="n">satellite</span><span class="o">.</span><span class="n">log_dict</span><span class="p">()</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    <span class="n">metadata_dict</span><span class="p">[</span><span class="s2">&quot;creation_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gs://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">gcs_save_folder</span><span class="si">}</span><span class="s2">/metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gs://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">gcs_save_folder</span><span class="si">}</span><span class="s2">/geodataframe.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;brotli&quot;</span><span class="p">)</span>

    <span class="n">file_uris</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">force_redownload</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;agl_multiple_sits_</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">completed_or_running_tasks</span>
        <span class="p">):</span>
            <span class="c1"># TODO: Also skip if the file already exists in GCS</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">download_multiple_sits_task_gcs</span><span class="p">(</span>
                <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">],</span>
                <span class="n">satellite</span><span class="p">,</span>
                <span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span>
                <span class="n">file_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gcs_save_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">reducers</span><span class="o">=</span><span class="n">reducers</span><span class="p">,</span>
                <span class="n">original_index_column_name</span><span class="o">=</span><span class="n">original_index_column_name</span><span class="p">,</span>
                <span class="n">start_date_column_name</span><span class="o">=</span><span class="n">start_date_column_name</span><span class="p">,</span>
                <span class="n">end_date_column_name</span><span class="o">=</span><span class="n">end_date_column_name</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">taskname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;agl_</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">_multiple_sits_</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">task_mgr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="n">file_uris</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gs://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">gcs_save_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>

    <span class="n">task_mgr</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
        <span class="n">task_mgr</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">file_uri</span> <span class="ow">in</span> <span class="n">file_uris</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_uri</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">sub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">sub_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">prepare_output_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.get.multiple_sits_gdrive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multiple_sits_gdrive</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="o">=</span><span class="s1">&#39;original_index&#39;</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="o">=</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="n">end_date_column_name</span><span class="o">=</span><span class="s1">&#39;end_date&#39;</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cluster_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">gee_save_folder</span><span class="o">=</span><span class="s1">&#39;AGL_EXPORTS&#39;</span><span class="p">,</span> <span class="n">force_redownload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#agrigee_lite.get.multiple_sits_gdrive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Download satellite time series using Google Earth Engine tasks to Google Drive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing geometries and temporal information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.AbstractSatellite">AbstractSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reducers</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>] or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of reducer names to apply, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_index_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column to store original indices, by default "original_index".</p>
              </div>
            </td>
            <td>
                  <code>&#39;original_index&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the start date column, by default "start_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;start_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date_column_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the end date column, by default "end_date".</p>
              </div>
            </td>
            <td>
                  <code>&#39;end_date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsampling_max_pixels</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum cluster size for spatial grouping, by default 500.</p>
              </div>
            </td>
            <td>
                  <code>500</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gee_save_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Google Drive folder name for saving exports, by default "AGL_EXPORTS".</p>
              </div>
            </td>
            <td>
                  <code>&#39;AGL_EXPORTS&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_redownload</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force re-download of existing data, by default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to wait for task completion, by default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/get/sits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_sits_chunks_gdrive</span><span class="p">(</span>
    <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
    <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">original_index_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original_index&quot;</span><span class="p">,</span>
    <span class="n">start_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
    <span class="n">end_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
    <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1_000</span><span class="p">,</span>
    <span class="n">cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">gee_save_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AGL_EXPORTS&quot;</span><span class="p">,</span>
    <span class="n">force_redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download satellite time series using Google Earth Engine tasks to Google Drive.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : gpd.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing geometries and temporal information.</span>
<span class="sd">    satellite : AbstractSatellite</span>
<span class="sd">        Satellite configuration object.</span>
<span class="sd">    reducers : set[str] or None, optional</span>
<span class="sd">        Set of reducer names to apply, by default None.</span>
<span class="sd">    original_index_column_name : str, optional</span>
<span class="sd">        Name of the column to store original indices, by default &quot;original_index&quot;.</span>
<span class="sd">    start_date_column_name : str, optional</span>
<span class="sd">        Name of the start date column, by default &quot;start_date&quot;.</span>
<span class="sd">    end_date_column_name : str, optional</span>
<span class="sd">        Name of the end date column, by default &quot;end_date&quot;.</span>
<span class="sd">    subsampling_max_pixels : float, optional</span>
<span class="sd">        Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</span>
<span class="sd">    cluster_size : int, optional</span>
<span class="sd">        Maximum cluster size for spatial grouping, by default 500.</span>
<span class="sd">    gee_save_folder : str, optional</span>
<span class="sd">        Google Drive folder name for saving exports, by default &quot;AGL_EXPORTS&quot;.</span>
<span class="sd">    force_redownload : bool, optional</span>
<span class="sd">        Whether to force re-download of existing data, by default False.</span>
<span class="sd">    wait : bool, optional</span>
<span class="sd">        Whether to wait for task completion, by default True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_multiple_sits_task_gdrive</span><span class="p">(</span>
        <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
        <span class="n">file_stem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">original_index_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original_index&quot;</span><span class="p">,</span>
        <span class="n">start_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;start_date&quot;</span><span class="p">,</span>
        <span class="n">end_date_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1_000</span><span class="p">,</span>
        <span class="n">taskname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">gee_save_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AGL_EXPORTS&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Task</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Google Earth Engine export task to Google Drive.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gdf : gpd.GeoDataFrame</span>
<span class="sd">            GeoDataFrame containing geometries and temporal information.</span>
<span class="sd">        satellite : AbstractSatellite</span>
<span class="sd">            Satellite configuration object.</span>
<span class="sd">        file_stem : str</span>
<span class="sd">            Base filename for the exported file.</span>
<span class="sd">        reducers : set[str] or None, optional</span>
<span class="sd">            Set of reducer names to apply, by default None.</span>
<span class="sd">        original_index_column_name : str, optional</span>
<span class="sd">            Name of the column to store original indices, by default &quot;original_index&quot;.</span>
<span class="sd">        start_date_column_name : str, optional</span>
<span class="sd">            Name of the start date column, by default &quot;start_date&quot;.</span>
<span class="sd">        end_date_column_name : str, optional</span>
<span class="sd">            Name of the end date column, by default &quot;end_date&quot;.</span>
<span class="sd">        subsampling_max_pixels : float, optional</span>
<span class="sd">            Maximum pixels for sampling: &gt;1 = absolute count, 1 = fraction of area (e.g., 0.5 = 50% sampling), by default 1_000.</span>
<span class="sd">        taskname : str, optional</span>
<span class="sd">            Custom task name, by default &quot;&quot;.</span>
<span class="sd">        gee_save_folder : str, optional</span>
<span class="sd">            Google Drive folder name, by default &quot;AGL_EXPORTS&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ee.batch.Task</span>
<span class="sd">            Earth Engine export task object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">taskname</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">taskname</span> <span class="o">=</span> <span class="n">file_stem</span>

        <span class="n">ee_expression</span> <span class="o">=</span> <span class="n">build_ee_expression</span><span class="p">(</span>
            <span class="n">gdf</span><span class="p">,</span>
            <span class="n">satellite</span><span class="p">,</span>
            <span class="n">reducers</span><span class="p">,</span>
            <span class="n">subsampling_max_pixels</span><span class="p">,</span>
            <span class="n">original_index_column_name</span><span class="p">,</span>
            <span class="n">start_date_column_name</span><span class="p">,</span>
            <span class="n">end_date_column_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">Export</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">toDrive</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">ee_expression</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">taskname</span><span class="p">,</span>
            <span class="n">fileFormat</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">,</span>
            <span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">file_stem</span><span class="p">,</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">gee_save_folder</span><span class="p">,</span>
            <span class="n">selectors</span><span class="o">=</span><span class="n">build_selectors</span><span class="p">(</span><span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">task</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">sanitize_and_prepare_input_gdf</span><span class="p">(</span>
        <span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">original_index_column_name</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="p">,</span> <span class="n">end_date_column_name</span>
    <span class="p">)</span>

    <span class="n">task_mgr</span> <span class="o">=</span> <span class="n">GEETaskManager</span><span class="p">()</span>

    <span class="n">tasks_df</span> <span class="o">=</span> <span class="n">ee_get_tasks_status</span><span class="p">()</span>
    <span class="n">tasks_df</span> <span class="o">=</span> <span class="n">tasks_df</span><span class="p">[</span><span class="n">tasks_df</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;agl_multiple_sits_&quot;</span><span class="p">)]</span>
    <span class="n">completed_or_running_tasks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">tasks_df</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># The task is the same, no matter who started it</span>

    <span class="n">username</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">hashname</span> <span class="o">=</span> <span class="n">create_gdf_hash</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">start_date_column_name</span><span class="p">,</span> <span class="n">end_date_column_name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Creating GEE tasks (</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_size</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">):</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">force_redownload</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;agl_multiple_sits_</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">completed_or_running_tasks</span>
        <span class="p">):</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">download_multiple_sits_task_gdrive</span><span class="p">(</span>
                <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">],</span>
                <span class="n">satellite</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">reducers</span><span class="o">=</span><span class="n">reducers</span><span class="p">,</span>
                <span class="n">original_index_column_name</span><span class="o">=</span><span class="n">original_index_column_name</span><span class="p">,</span>
                <span class="n">start_date_column_name</span><span class="o">=</span><span class="n">start_date_column_name</span><span class="p">,</span>
                <span class="n">end_date_column_name</span><span class="o">=</span><span class="n">end_date_column_name</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">taskname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;agl_</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">_sits_</span><span class="si">{</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">gee_save_folder</span><span class="o">=</span><span class="n">gee_save_folder</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">task_mgr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="n">task_mgr</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start all tasks at once allows user to cancel them before submitted to GEE</span>

    <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
        <span class="n">task_mgr</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="agrigee_lite.sat"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.ANADEM" class="doc doc-heading">
            <code>ANADEM</code>


<a href="#agrigee_lite.sat.ANADEM" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.SingleImageSatellite">SingleImageSatellite</span></code></p>


        <p>Satellite abstraction for ANADEM (Altimetric and Topographic Attributes of the Brazilian Territory).</p>
<p>ANADEM is a DEM-derived (Digital Elevation Model) product designed to support land analysis
based on elevation, slope, and aspect characteristics across the Brazilian territory.
It is particularly useful for ecological zoning, terrain classification, hydrological modeling,
and environmental risk assessment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to select. Defaults to ['elevation', 'slope', 'aspect'].
- 'elevation': Ground elevation in meters.
- 'slope': Degree of inclination derived from elevation.
- 'aspect': Direction of slope (0-360), where 0 = North.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border to reduce edge artifacts.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>50_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+------------------------------------+-----------------------------+
| Field                              | Value                       |
+------------------------------------+-----------------------------+
| Name                               | ANADEM                      |
| Resolution                         | 30 meters                   |
| Source                             | FURGS, ANA                  |
| Coverage                           | Brazil                      |
| Derived From                       | SRTM + auxiliary DEMs       |
+------------------------------------+-----------------------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------------------------+---------------------------+
| Band Name | Description                | Unit / Range              |
+-----------+----------------------------+---------------------------+
| elevation | Ground elevation           | meters above sea level    |
| slope     | Terrain slope              | degrees (0-90)          |
| aspect    | Orientation of slope       | degrees (0-360 from N)  |
+-----------+----------------------------+---------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The slope and aspect bands are computed from the elevation layer using the
<code>ee.Terrain.products()</code> utility.</li>
<li>The <code>compute()</code> method calculates:<ul>
<li>Mean elevation over the region.</li>
<li>Percentage breakdown of slope classes:<ul>
<li>Flat (0-3), Gentle (3-8), Undulating (8-20),
Strong (20-45), Mountainous (45-75), and Steep (&gt;75).</li>
</ul>
</li>
<li>Percentage breakdown of aspect classes:<ul>
<li>North, NE, East, SE, South, SW, West, NW.</li>
</ul>
</li>
</ul>
</li>
<li>These statistics are returned as a <code>FeatureCollection</code> with a single feature
containing the computed values.</li>
<li>Reference paper: https://www.mdpi.com/2072-4292/16/13/2321</li>
<li>Data source: https://hge-iph.github.io/anadem/</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/dem.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ANADEM</span><span class="p">(</span><span class="n">SingleImageSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for ANADEM (Altimetric and Topographic Attributes of the Brazilian Territory).</span>

<span class="sd">    ANADEM is a DEM-derived (Digital Elevation Model) product designed to support land analysis</span>
<span class="sd">    based on elevation, slope, and aspect characteristics across the Brazilian territory.</span>
<span class="sd">    It is particularly useful for ecological zoning, terrain classification, hydrological modeling,</span>
<span class="sd">    and environmental risk assessment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : list of str, optional</span>
<span class="sd">        List of bands to select. Defaults to [&#39;elevation&#39;, &#39;slope&#39;, &#39;aspect&#39;].</span>
<span class="sd">        - &#39;elevation&#39;: Ground elevation in meters.</span>
<span class="sd">        - &#39;slope&#39;: Degree of inclination derived from elevation.</span>
<span class="sd">        - &#39;aspect&#39;: Direction of slope (0-360), where 0 = North.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border to reduce edge artifacts.</span>
<span class="sd">    min_area_to_keep_border : int, default=50_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +------------------------------------+-----------------------------+</span>
<span class="sd">    | Field                              | Value                       |</span>
<span class="sd">    +------------------------------------+-----------------------------+</span>
<span class="sd">    | Name                               | ANADEM                      |</span>
<span class="sd">    | Resolution                         | 30 meters                   |</span>
<span class="sd">    | Source                             | FURGS, ANA                  |</span>
<span class="sd">    | Coverage                           | Brazil                      |</span>
<span class="sd">    | Derived From                       | SRTM + auxiliary DEMs       |</span>
<span class="sd">    +------------------------------------+-----------------------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------------------------+---------------------------+</span>
<span class="sd">    | Band Name | Description                | Unit / Range              |</span>
<span class="sd">    +-----------+----------------------------+---------------------------+</span>
<span class="sd">    | elevation | Ground elevation           | meters above sea level    |</span>
<span class="sd">    | slope     | Terrain slope              | degrees (0-90)          |</span>
<span class="sd">    | aspect    | Orientation of slope       | degrees (0-360 from N)  |</span>
<span class="sd">    +-----------+----------------------------+---------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The slope and aspect bands are computed from the elevation layer using the</span>
<span class="sd">    `ee.Terrain.products()` utility.</span>
<span class="sd">    - The `compute()` method calculates:</span>
<span class="sd">        - Mean elevation over the region.</span>
<span class="sd">        - Percentage breakdown of slope classes:</span>
<span class="sd">            - Flat (0-3), Gentle (3-8), Undulating (8-20),</span>
<span class="sd">            Strong (20-45), Mountainous (45-75), and Steep (&gt;75).</span>
<span class="sd">        - Percentage breakdown of aspect classes:</span>
<span class="sd">            - North, NE, East, SE, South, SW, West, NW.</span>
<span class="sd">    - These statistics are returned as a `FeatureCollection` with a single feature</span>
<span class="sd">    containing the computed values.</span>
<span class="sd">    - Reference paper: https://www.mdpi.com/2072-4292/16/13/2321</span>
<span class="sd">    - Data source: https://hge-iph.github.io/anadem/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;elevation&quot;</span><span class="p">,</span> <span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="s2">&quot;aspect&quot;</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imageName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;projects/et-brasil/assets/anadem/v1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;anadem&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span> <span class="o">=</span> <span class="s2">&quot;1900-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_to_download_selectors</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_to_download_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">band_aliases</span> <span class="o">=</span> <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;elevation&quot;</span> <span class="ow">in</span> <span class="n">band_aliases</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;40_elevation_mean&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;slope&quot;</span> <span class="ow">in</span> <span class="n">band_aliases</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s2">&quot;41_slope_flat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;42_slope_gentle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;43_slope_undulating&quot;</span><span class="p">,</span>
                <span class="s2">&quot;44_slope_strong&quot;</span><span class="p">,</span>
                <span class="s2">&quot;45_slope_mountainous&quot;</span><span class="p">,</span>
                <span class="s2">&quot;46_slope_steep&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;aspect&quot;</span> <span class="ow">in</span> <span class="n">band_aliases</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s2">&quot;47_cardinal_n&quot;</span><span class="p">,</span>
                <span class="s2">&quot;48_cardinal_ne&quot;</span><span class="p">,</span>
                <span class="s2">&quot;49_cardinal_e&quot;</span><span class="p">,</span>
                <span class="s2">&quot;50_cardinal_se&quot;</span><span class="p">,</span>
                <span class="s2">&quot;51_cardinal_s&quot;</span><span class="p">,</span>
                <span class="s2">&quot;52_cardinal_sw&quot;</span><span class="p">,</span>
                <span class="s2">&quot;53_cardinal_w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;54_cardinal_nw&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">selectors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageName</span><span class="p">)</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageName</span><span class="p">)</span><span class="o">.</span><span class="n">neq</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">))</span>

        <span class="n">requested_bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">b</span> <span class="ow">in</span> <span class="n">requested_bands</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="s2">&quot;aspect&quot;</span><span class="p">]):</span>
            <span class="n">terrain</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Terrain</span><span class="o">.</span><span class="n">products</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">terrain</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="s2">&quot;aspect&quot;</span><span class="p">]))</span>

        <span class="n">selected_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
        <span class="n">renamed_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">image</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selected_band_names</span><span class="p">,</span> <span class="n">renamed_band_names</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">ee_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>
        <span class="n">ee_img</span> <span class="o">=</span> <span class="n">ee_map_valid_pixels</span><span class="p">(</span><span class="n">ee_img</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">)</span>

        <span class="n">selected_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>

        <span class="n">stats_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;00_indexnum&quot;</span><span class="p">:</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># --- Elevation mean ---</span>
        <span class="k">if</span> <span class="s2">&quot;elevation&quot;</span> <span class="ow">in</span> <span class="n">selected_band_names</span><span class="p">:</span>
            <span class="n">elevation_mean</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ee_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;elevation&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                    <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                    <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;elevation&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;40_elevation_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elevation_mean</span>

        <span class="c1"># --- Slope class breakdown ---</span>
        <span class="k">if</span> <span class="s2">&quot;slope&quot;</span> <span class="ow">in</span> <span class="n">selected_band_names</span><span class="p">:</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;slope&quot;</span><span class="p">)</span>

            <span class="n">slope_classes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;41_slope_flat&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">slope</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
                <span class="s2">&quot;42_slope_gentle&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">slope</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
                <span class="s2">&quot;43_slope_undulating&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">slope</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span>
                <span class="s2">&quot;44_slope_strong&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">slope</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">45</span><span class="p">)),</span>
                <span class="s2">&quot;45_slope_mountainous&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">slope</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="mi">75</span><span class="p">)),</span>
                <span class="s2">&quot;46_slope_steep&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;slope&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span>
            <span class="n">total_pixels</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                    <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                    <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                    <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">slope_classes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                        <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                        <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                        <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                        <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">percent</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">total_pixels</span><span class="p">)</span>
                <span class="n">stats_dict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">percent</span>

        <span class="c1"># --- Aspect class breakdown ---</span>
        <span class="k">if</span> <span class="s2">&quot;aspect&quot;</span> <span class="ow">in</span> <span class="n">selected_band_names</span><span class="p">:</span>
            <span class="n">aspect</span> <span class="o">=</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;aspect&quot;</span><span class="p">)</span>

            <span class="n">aspect_classes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;47_cardinal_n&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">337.5</span><span class="p">)</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">22.5</span><span class="p">)),</span>
                <span class="s2">&quot;48_cardinal_ne&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">22.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">67.5</span><span class="p">)),</span>
                <span class="s2">&quot;49_cardinal_e&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">67.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">112.5</span><span class="p">)),</span>
                <span class="s2">&quot;50_cardinal_se&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">112.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">157.5</span><span class="p">)),</span>
                <span class="s2">&quot;51_cardinal_s&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">157.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">202.5</span><span class="p">)),</span>
                <span class="s2">&quot;52_cardinal_sw&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">202.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">247.5</span><span class="p">)),</span>
                <span class="s2">&quot;53_cardinal_w&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">247.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">292.5</span><span class="p">)),</span>
                <span class="s2">&quot;54_cardinal_nw&quot;</span><span class="p">:</span> <span class="n">aspect</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mf">292.5</span><span class="p">)</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mf">337.5</span><span class="p">)),</span>
            <span class="p">}</span>

            <span class="n">valid_aspect</span> <span class="o">=</span> <span class="n">aspect</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span>
            <span class="n">total_aspect_pixels</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid_aspect</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                    <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                    <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                    <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">aspect_classes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                        <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                        <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                        <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                        <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                        <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">percent</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">total_aspect_pixels</span><span class="p">)</span>
                <span class="n">stats_dict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">percent</span>

        <span class="c1"># --- ValidPixelCount ---</span>
        <span class="n">valid_pixel_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ee_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selected_band_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">.</span><span class="n">mask</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="n">selected_band_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;99_validPixelsCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_pixel_count</span>

        <span class="n">stats_feature</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">stats_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">([</span><span class="n">stats_feature</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Landsat5" class="doc doc-heading">
            <code>Landsat5</code>


<a href="#agrigee_lite.sat.Landsat5" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.landsat.AbstractLandsat">AbstractLandsat</span></code></p>


        <p>Satellite abstraction for Landsat 5 (TM sensor, Collection 2).</p>
<p>Landsat 5 was launched in 1984 and provided more than 29 years of Earth observation data.
This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['blue', 'green', 'red', 'nir', 'swir1', 'swir2'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral indices to compute from the selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_sr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use surface reflectance products ('SR_B<em>' bands).
If False, uses top-of-atmosphere reflectance ('B</em>' bands).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tier</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>toa_cloud_filter_strength</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).
Used in the <code>remove_l_toa_tough_clouds</code> step.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>50_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:
- Applied to both TOA and SR products when <code>use_cloud_mask=True</code>
- For TOA collections, an additional filter (<code>remove_l_toa_tough_clouds</code>) is applied
to remove low-quality observations based on a simple cloud scoring method.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | Landsat 5 TM           |
| Sensor                     | TM (Thematic Mapper)   |
| Platform                   | Landsat 5              |
| Temporal Resolution        | 16 days                |
| Pixel Size                 | 30 meters              |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+-------------+------------+------------+
| Product     | Start Date | End Date  |
+-------------+------------+------------+
| TOA         | 1984-03-01 | 2013-05-05 |
| SR          | 1984-03-01 | 2012-05-05 |
+-------------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------+-----------+------------------------+
| Band Name | TOA Name | SR Name   | Spectral Wavelength    |
+-----------+----------+-----------+------------------------+
| blue      | B1       | SR_B1     | 450-520 nm             |
| green     | B2       | SR_B2     | 520-600 nm             |
| red       | B3       | SR_B3     | 630-690 nm             |
| nir       | B4       | SR_B4     | 770-900 nm             |
| swir1     | B5       | SR_B5     | 1550-1750 nm           |
| swir2     | B7       | SR_B7     | 2090-2350 nm           |
+-----------+----------+-----------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Landsat 5 TOA Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T1_TOA</p>
</li>
<li>
<p>Landsat 5 TOA Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T2_TOA</p>
</li>
<li>
<p>Landsat 5 SR Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T1_L2</p>
</li>
<li>
<p>Landsat 5 SR Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T2_L2</p>
</li>
<li>
<p>Cloud mask reference (QA_PIXEL flags):
    https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</p>
</li>
<li>
<p>TOA cloud filtering (Simple Cloud Score):
    https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/landsat.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Landsat5</span><span class="p">(</span><span class="n">AbstractLandsat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for Landsat 5 (TM sensor, Collection 2).</span>

<span class="sd">    Landsat 5 was launched in 1984 and provided more than 29 years of Earth observation data.</span>
<span class="sd">    This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Spectral indices to compute from the selected bands.</span>
<span class="sd">    use_sr : bool, default=True</span>
<span class="sd">        Whether to use surface reflectance products (&#39;SR_B*&#39; bands).</span>
<span class="sd">        If False, uses top-of-atmosphere reflectance (&#39;B*&#39; bands).</span>
<span class="sd">    tier : int, default=1</span>
<span class="sd">        Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</span>
<span class="sd">    min_valid_pixel_count : int, default=12</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    toa_cloud_filter_strength : int, default=15</span>
<span class="sd">        Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).</span>
<span class="sd">        Used in the `remove_l_toa_tough_clouds` step.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=50_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:</span>
<span class="sd">    - Applied to both TOA and SR products when `use_cloud_mask=True`</span>
<span class="sd">    - For TOA collections, an additional filter (`remove_l_toa_tough_clouds`) is applied</span>
<span class="sd">    to remove low-quality observations based on a simple cloud scoring method.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | Landsat 5 TM           |</span>
<span class="sd">    | Sensor                     | TM (Thematic Mapper)   |</span>
<span class="sd">    | Platform                   | Landsat 5              |</span>
<span class="sd">    | Temporal Resolution        | 16 days                |</span>
<span class="sd">    | Pixel Size                 | 30 meters              |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | Product     | Start Date | End Date  |</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | TOA         | 1984-03-01 | 2013-05-05 |</span>
<span class="sd">    | SR          | 1984-03-01 | 2012-05-05 |</span>
<span class="sd">    +-------------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | Band Name | TOA Name | SR Name   | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | blue      | B1       | SR_B1     | 450-520 nm             |</span>
<span class="sd">    | green     | B2       | SR_B2     | 520-600 nm             |</span>
<span class="sd">    | red       | B3       | SR_B3     | 630-690 nm             |</span>
<span class="sd">    | nir       | B4       | SR_B4     | 770-900 nm             |</span>
<span class="sd">    | swir1     | B5       | SR_B5     | 1550-1750 nm           |</span>
<span class="sd">    | swir2     | B7       | SR_B7     | 2090-2350 nm           |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Landsat 5 TOA Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T1_TOA</span>

<span class="sd">    - Landsat 5 TOA Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T2_TOA</span>

<span class="sd">    - Landsat 5 SR Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T1_L2</span>

<span class="sd">    - Landsat 5 SR Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T2_L2</span>

<span class="sd">    - Cloud mask reference (QA_PIXEL flags):</span>
<span class="sd">        https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</span>

<span class="sd">    - TOA cloud filtering (Simple Cloud Score):</span>
<span class="sd">        https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_sr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tier</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">toa_cloud_filter_strength</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span> <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;B7&quot;</span><span class="p">}</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B7&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
            <span class="n">sensor_code</span><span class="o">=</span><span class="s2">&quot;LT05&quot;</span><span class="p">,</span>
            <span class="n">toa_band_map</span><span class="o">=</span><span class="n">toa</span><span class="p">,</span>
            <span class="n">sr_band_map</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">short_base</span><span class="o">=</span><span class="s2">&quot;l5&quot;</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1984-03-01&quot;</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2013-05-05&quot;</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">use_sr</span><span class="o">=</span><span class="n">use_sr</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
            <span class="n">use_cloud_mask</span><span class="o">=</span><span class="n">use_cloud_mask</span><span class="p">,</span>
            <span class="n">min_valid_pixel_count</span><span class="o">=</span><span class="n">min_valid_pixel_count</span><span class="p">,</span>
            <span class="n">toa_cloud_filter_strength</span><span class="o">=</span><span class="n">toa_cloud_filter_strength</span><span class="p">,</span>
            <span class="n">border_pixels_to_erode</span><span class="o">=</span><span class="n">border_pixels_to_erode</span><span class="p">,</span>
            <span class="n">min_area_to_keep_border</span><span class="o">=</span><span class="n">min_area_to_keep_border</span><span class="p">,</span>
            <span class="n">use_pan_sharpening</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Landsat7" class="doc doc-heading">
            <code>Landsat7</code>


<a href="#agrigee_lite.sat.Landsat7" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.landsat.AbstractLandsat">AbstractLandsat</span></code></p>


        <p>Satellite abstraction for Landsat 7 (ETM+ sensor, Collection 2).</p>
<p>Landsat 7 was launched in 1999 and provided over two decades of data.
This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['blue', 'green', 'red', 'nir', 'swir1', 'swir2'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral indices to compute from the selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_sr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use surface reflectance products ('SR_B<em>' bands).
If False, uses top-of-atmosphere reflectance ('B</em>' bands).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tier</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>toa_cloud_filter_strength</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).
Used in the <code>remove_l_toa_tough_clouds</code> step.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>50_000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_pan_sharpening</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).
Only applicable when <code>use_sr=False</code>. Raises ValueError if used with SR products.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:
- Applied to both TOA and SR products when <code>use_cloud_mask=True</code>
- For TOA collections, an additional filter (<code>remove_l_toa_tough_clouds</code>) is applied
to remove low-quality observations based on a simple cloud scoring method.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | Landsat 7 ETM+         |
| Sensor                     | ETM+ (Enhanced TM Plus)|
| Platform                   | Landsat 7              |
| Temporal Resolution        | 16 days                |
| Pixel Size                 | 30 meters              |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+-------------+------------+------------+
| Product     | Start Date | End Date  |
+-------------+------------+------------+
| TOA         | 1999-04-15 | 2022-04-06 |
| SR          | 1999-04-15 | 2022-04-06 |
+-------------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------+-----------+------------------------+
| Band Name | TOA Name | SR Name   | Spectral Wavelength    |
+-----------+----------+-----------+------------------------+
| blue      | B1       | SR_B1     | 450-520 nm             |
| green     | B2       | SR_B2     | 520-600 nm             |
| red       | B3       | SR_B3     | 630-690 nm             |
| nir       | B4       | SR_B4     | 770-900 nm             |
| swir1     | B5       | SR_B5     | 1550-1750 nm           |
| swir2     | B7       | SR_B7     | 2090-2350 nm           |
| pan       | B8       |          | 520-900 nm (panchromatic) |
+-----------+----------+-----------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Landsat 7 TOA Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T1_TOA</p>
</li>
<li>
<p>Landsat 7 TOA Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T2_TOA</p>
</li>
<li>
<p>Landsat 7 SR Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T1_L2</p>
</li>
<li>
<p>Landsat 7 SR Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T2_L2</p>
</li>
<li>
<p>Cloud mask reference (QA_PIXEL flags):
    https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</p>
</li>
<li>
<p>TOA cloud filtering (Simple Cloud Score):
    https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/landsat.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Landsat7</span><span class="p">(</span><span class="n">AbstractLandsat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for Landsat 7 (ETM+ sensor, Collection 2).</span>

<span class="sd">    Landsat 7 was launched in 1999 and provided over two decades of data.</span>
<span class="sd">    This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Spectral indices to compute from the selected bands.</span>
<span class="sd">    use_sr : bool, default=True</span>
<span class="sd">        Whether to use surface reflectance products (&#39;SR_B*&#39; bands).</span>
<span class="sd">        If False, uses top-of-atmosphere reflectance (&#39;B*&#39; bands).</span>
<span class="sd">    tier : int, default=1</span>
<span class="sd">        Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</span>
<span class="sd">    min_valid_pixel_count : int, default=12</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    toa_cloud_filter_strength : int, default=15</span>
<span class="sd">        Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).</span>
<span class="sd">        Used in the `remove_l_toa_tough_clouds` step.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=50_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>
<span class="sd">    use_pan_sharpening : bool, default=False</span>
<span class="sd">        If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).</span>
<span class="sd">        Only applicable when `use_sr=False`. Raises ValueError if used with SR products.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:</span>
<span class="sd">    - Applied to both TOA and SR products when `use_cloud_mask=True`</span>
<span class="sd">    - For TOA collections, an additional filter (`remove_l_toa_tough_clouds`) is applied</span>
<span class="sd">    to remove low-quality observations based on a simple cloud scoring method.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | Landsat 7 ETM+         |</span>
<span class="sd">    | Sensor                     | ETM+ (Enhanced TM Plus)|</span>
<span class="sd">    | Platform                   | Landsat 7              |</span>
<span class="sd">    | Temporal Resolution        | 16 days                |</span>
<span class="sd">    | Pixel Size                 | 30 meters              |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | Product     | Start Date | End Date  |</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | TOA         | 1999-04-15 | 2022-04-06 |</span>
<span class="sd">    | SR          | 1999-04-15 | 2022-04-06 |</span>
<span class="sd">    +-------------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | Band Name | TOA Name | SR Name   | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | blue      | B1       | SR_B1     | 450-520 nm             |</span>
<span class="sd">    | green     | B2       | SR_B2     | 520-600 nm             |</span>
<span class="sd">    | red       | B3       | SR_B3     | 630-690 nm             |</span>
<span class="sd">    | nir       | B4       | SR_B4     | 770-900 nm             |</span>
<span class="sd">    | swir1     | B5       | SR_B5     | 1550-1750 nm           |</span>
<span class="sd">    | swir2     | B7       | SR_B7     | 2090-2350 nm           |</span>
<span class="sd">    | pan       | B8       |          | 520-900 nm (panchromatic) |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Landsat 7 TOA Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T1_TOA</span>

<span class="sd">    - Landsat 7 TOA Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T2_TOA</span>

<span class="sd">    - Landsat 7 SR Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T1_L2</span>

<span class="sd">    - Landsat 7 SR Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LE07_C02_T2_L2</span>

<span class="sd">    - Cloud mask reference (QA_PIXEL flags):</span>
<span class="sd">        https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</span>

<span class="sd">    - TOA cloud filtering (Simple Cloud Score):</span>
<span class="sd">        https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_sr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tier</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">toa_cloud_filter_strength</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
        <span class="n">use_pan_sharpening</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span> <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;B7&quot;</span><span class="p">,</span> <span class="s2">&quot;pan&quot;</span><span class="p">:</span> <span class="s2">&quot;B8&quot;</span><span class="p">}</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B7&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
            <span class="n">sensor_code</span><span class="o">=</span><span class="s2">&quot;LE07&quot;</span><span class="p">,</span>
            <span class="n">toa_band_map</span><span class="o">=</span><span class="n">toa</span><span class="p">,</span>
            <span class="n">sr_band_map</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">short_base</span><span class="o">=</span><span class="s2">&quot;l7&quot;</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1999-04-15&quot;</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2022-04-06&quot;</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">use_sr</span><span class="o">=</span><span class="n">use_sr</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
            <span class="n">use_cloud_mask</span><span class="o">=</span><span class="n">use_cloud_mask</span><span class="p">,</span>
            <span class="n">min_valid_pixel_count</span><span class="o">=</span><span class="n">min_valid_pixel_count</span><span class="p">,</span>
            <span class="n">toa_cloud_filter_strength</span><span class="o">=</span><span class="n">toa_cloud_filter_strength</span><span class="p">,</span>
            <span class="n">border_pixels_to_erode</span><span class="o">=</span><span class="n">border_pixels_to_erode</span><span class="p">,</span>
            <span class="n">min_area_to_keep_border</span><span class="o">=</span><span class="n">min_area_to_keep_border</span><span class="p">,</span>
            <span class="n">use_pan_sharpening</span><span class="o">=</span><span class="n">use_pan_sharpening</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Landsat8" class="doc doc-heading">
            <code>Landsat8</code>


<a href="#agrigee_lite.sat.Landsat8" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.landsat.AbstractLandsat">AbstractLandsat</span></code></p>


        <p>Satellite abstraction for Landsat 8 (OLI/TIRS sensor, Collection 2).</p>
<p>Landsat 8 was launched in 2013 and remains in operation, delivering high-quality Earth observation data.
This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['blue', 'green', 'red', 'nir', 'swir1', 'swir2'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral indices to compute from the selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_sr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use surface reflectance products ('SR_B<em>' bands).
If False, uses top-of-atmosphere reflectance ('B</em>' bands).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tier</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>toa_cloud_filter_strength</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).
Used in the <code>remove_l_toa_tough_clouds</code> step.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>50_000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_pan_sharpening</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).
Only applicable when <code>use_sr=False</code>. Raises ValueError if used with SR products.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:
- Applied to both TOA and SR products when <code>use_cloud_mask=True</code>
- For TOA collections, an additional filter (<code>remove_l_toa_tough_clouds</code>) is applied
to remove low-quality observations based on a simple cloud scoring method.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | Landsat 8 OLI/TIRS     |
| Sensor                     | OLI + TIRS             |
| Platform                   | Landsat 8              |
| Temporal Resolution        | 16 days                |
| Pixel Size                 | 30 meters              |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+-------------+------------+------------+
| Product     | Start Date | End Date  |
+-------------+------------+------------+
| TOA         | 2013-04-11 | present   |
| SR          | 2013-04-11 | present   |
+-------------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------+-----------+------------------------+
| Band Name | TOA Name | SR Name   | Spectral Wavelength    |
+-----------+----------+-----------+------------------------+
| blue      | B2       | SR_B2     | 450-515 nm             |
| green     | B3       | SR_B3     | 525-600 nm             |
| red       | B4       | SR_B4     | 630-680 nm             |
| nir       | B5       | SR_B5     | 845-885 nm             |
| swir1     | B6       | SR_B6     | 1560-1660 nm           |
| swir2     | B7       | SR_B7     | 2100-2300 nm           |
| pan       | B8       |          | 520-900 nm (panchromatic) |
+-----------+----------+-----------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Landsat 8 TOA Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_TOA</p>
</li>
<li>
<p>Landsat 8 TOA Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T2_TOA</p>
</li>
<li>
<p>Landsat 8 SR Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2</p>
</li>
<li>
<p>Landsat 8 SR Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T2_L2</p>
</li>
<li>
<p>Cloud mask reference (QA_PIXEL flags):
    https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</p>
</li>
<li>
<p>TOA cloud filtering (Simple Cloud Score):
    https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/landsat.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Landsat8</span><span class="p">(</span><span class="n">AbstractLandsat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for Landsat 8 (OLI/TIRS sensor, Collection 2).</span>

<span class="sd">    Landsat 8 was launched in 2013 and remains in operation, delivering high-quality Earth observation data.</span>
<span class="sd">    This class supports both TOA and SR products, with optional cloud masking using the QA_PIXEL band.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Spectral indices to compute from the selected bands.</span>
<span class="sd">    use_sr : bool, default=True</span>
<span class="sd">        Whether to use surface reflectance products (&#39;SR_B*&#39; bands).</span>
<span class="sd">        If False, uses top-of-atmosphere reflectance (&#39;B*&#39; bands).</span>
<span class="sd">    tier : int, default=1</span>
<span class="sd">        Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</span>
<span class="sd">    min_valid_pixel_count : int, default=12</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    toa_cloud_filter_strength : int, default=15</span>
<span class="sd">        Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).</span>
<span class="sd">        Used in the `remove_l_toa_tough_clouds` step.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=50_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>
<span class="sd">    use_pan_sharpening : bool, default=False</span>
<span class="sd">        If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).</span>
<span class="sd">        Only applicable when `use_sr=False`. Raises ValueError if used with SR products.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:</span>
<span class="sd">    - Applied to both TOA and SR products when `use_cloud_mask=True`</span>
<span class="sd">    - For TOA collections, an additional filter (`remove_l_toa_tough_clouds`) is applied</span>
<span class="sd">    to remove low-quality observations based on a simple cloud scoring method.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | Landsat 8 OLI/TIRS     |</span>
<span class="sd">    | Sensor                     | OLI + TIRS             |</span>
<span class="sd">    | Platform                   | Landsat 8              |</span>
<span class="sd">    | Temporal Resolution        | 16 days                |</span>
<span class="sd">    | Pixel Size                 | 30 meters              |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | Product     | Start Date | End Date  |</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | TOA         | 2013-04-11 | present   |</span>
<span class="sd">    | SR          | 2013-04-11 | present   |</span>
<span class="sd">    +-------------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | Band Name | TOA Name | SR Name   | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | blue      | B2       | SR_B2     | 450-515 nm             |</span>
<span class="sd">    | green     | B3       | SR_B3     | 525-600 nm             |</span>
<span class="sd">    | red       | B4       | SR_B4     | 630-680 nm             |</span>
<span class="sd">    | nir       | B5       | SR_B5     | 845-885 nm             |</span>
<span class="sd">    | swir1     | B6       | SR_B6     | 1560-1660 nm           |</span>
<span class="sd">    | swir2     | B7       | SR_B7     | 2100-2300 nm           |</span>
<span class="sd">    | pan       | B8       |          | 520-900 nm (panchromatic) |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Landsat 8 TOA Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_TOA</span>

<span class="sd">    - Landsat 8 TOA Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T2_TOA</span>

<span class="sd">    - Landsat 8 SR Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2</span>

<span class="sd">    - Landsat 8 SR Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T2_L2</span>

<span class="sd">    - Cloud mask reference (QA_PIXEL flags):</span>
<span class="sd">        https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</span>

<span class="sd">    - TOA cloud filtering (Simple Cloud Score):</span>
<span class="sd">        https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_sr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tier</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">toa_cloud_filter_strength</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
        <span class="n">use_pan_sharpening</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span> <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;B6&quot;</span><span class="p">,</span> <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;B7&quot;</span><span class="p">,</span> <span class="s2">&quot;pan&quot;</span><span class="p">:</span> <span class="s2">&quot;B8&quot;</span><span class="p">}</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B7&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
            <span class="n">sensor_code</span><span class="o">=</span><span class="s2">&quot;LC08&quot;</span><span class="p">,</span>
            <span class="n">toa_band_map</span><span class="o">=</span><span class="n">toa</span><span class="p">,</span>
            <span class="n">sr_band_map</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">short_base</span><span class="o">=</span><span class="s2">&quot;l8&quot;</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2013-04-11&quot;</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2050-01-01&quot;</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">use_sr</span><span class="o">=</span><span class="n">use_sr</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
            <span class="n">use_cloud_mask</span><span class="o">=</span><span class="n">use_cloud_mask</span><span class="p">,</span>
            <span class="n">min_valid_pixel_count</span><span class="o">=</span><span class="n">min_valid_pixel_count</span><span class="p">,</span>
            <span class="n">toa_cloud_filter_strength</span><span class="o">=</span><span class="n">toa_cloud_filter_strength</span><span class="p">,</span>
            <span class="n">border_pixels_to_erode</span><span class="o">=</span><span class="n">border_pixels_to_erode</span><span class="p">,</span>
            <span class="n">min_area_to_keep_border</span><span class="o">=</span><span class="n">min_area_to_keep_border</span><span class="p">,</span>
            <span class="n">use_pan_sharpening</span><span class="o">=</span><span class="n">use_pan_sharpening</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Landsat9" class="doc doc-heading">
            <code>Landsat9</code>


<a href="#agrigee_lite.sat.Landsat9" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.landsat.AbstractLandsat">AbstractLandsat</span></code></p>


        <p>Satellite abstraction for Landsat 9 (OLI-2/TIRS-2 sensor, Collection 2).</p>
<p>Landsat 9 is the latest mission in the Landsat program, launched in 2021. It is nearly identical to Landsat 8
and provides continuity for high-quality multispectral Earth observation. This class supports both TOA and SR
products, with optional cloud masking using the QA_PIXEL band.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['blue', 'green', 'red', 'nir', 'swir1', 'swir2'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral indices to compute from the selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_sr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use surface reflectance products ('SR_B<em>' bands).
If False, uses top-of-atmosphere reflectance ('B</em>' bands).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tier</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>toa_cloud_filter_strength</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).
Used in the <code>remove_l_toa_tough_clouds</code> step.</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>50_000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_pan_sharpening</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).
Only applicable when <code>use_sr=False</code>. Raises ValueError if used with SR products.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:
- Applied to both TOA and SR products when <code>use_cloud_mask=True</code>
- For TOA collections, an additional filter (<code>remove_l_toa_tough_clouds</code>) is applied
to remove low-quality observations based on a simple cloud scoring method.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | Landsat 9 OLI-2/TIRS-2 |
| Sensor                     | OLI-2 + TIRS-2         |
| Platform                   | Landsat 9              |
| Temporal Resolution        | 16 days                |
| Pixel Size                 | 30 meters              |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+-------------+------------+------------+
| Product     | Start Date | End Date  |
+-------------+------------+------------+
| TOA         | 2021-11-01 | present   |
| SR          | 2021-11-01 | present   |
+-------------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------+-----------+------------------------+
| Band Name | TOA Name | SR Name   | Spectral Wavelength    |
+-----------+----------+-----------+------------------------+
| blue      | B2       | SR_B2     | 450-515 nm             |
| green     | B3       | SR_B3     | 525-600 nm             |
| red       | B4       | SR_B4     | 630-680 nm             |
| nir       | B5       | SR_B5     | 845-885 nm             |
| swir1     | B6       | SR_B6     | 1560-1660 nm           |
| swir2     | B7       | SR_B7     | 2100-2300 nm           |
| pan       | B8       |          | 520-900 nm (panchromatic) |
+-----------+----------+-----------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Landsat 9 TOA Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T1_TOA</p>
</li>
<li>
<p>Landsat 9 TOA Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T2_TOA</p>
</li>
<li>
<p>Landsat 9 SR Collection (Tier 1):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T1_L2</p>
</li>
<li>
<p>Landsat 9 SR Collection (Tier 2):
    https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T2_L2</p>
</li>
<li>
<p>Cloud mask reference (QA_PIXEL flags):
    https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</p>
</li>
<li>
<p>TOA cloud filtering (Simple Cloud Score):
    https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/landsat.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Landsat9</span><span class="p">(</span><span class="n">AbstractLandsat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for Landsat 9 (OLI-2/TIRS-2 sensor, Collection 2).</span>

<span class="sd">    Landsat 9 is the latest mission in the Landsat program, launched in 2021. It is nearly identical to Landsat 8</span>
<span class="sd">    and provides continuity for high-quality multispectral Earth observation. This class supports both TOA and SR</span>
<span class="sd">    products, with optional cloud masking using the QA_PIXEL band.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Spectral indices to compute from the selected bands.</span>
<span class="sd">    use_sr : bool, default=True</span>
<span class="sd">        Whether to use surface reflectance products (&#39;SR_B*&#39; bands).</span>
<span class="sd">        If False, uses top-of-atmosphere reflectance (&#39;B*&#39; bands).</span>
<span class="sd">    tier : int, default=1</span>
<span class="sd">        Landsat collection tier to use (1 or 2). Tier 1 has highest geometric accuracy.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply QA_PIXEL-based cloud masking. If False, no cloud mask is applied.</span>
<span class="sd">    min_valid_pixel_count : int, default=12</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    toa_cloud_filter_strength : int, default=15</span>
<span class="sd">        Strength of the additional cloud filter applied to TOA imagery (if use_sr=False).</span>
<span class="sd">        Used in the `remove_l_toa_tough_clouds` step.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=50_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>
<span class="sd">    use_pan_sharpening : bool, default=False</span>
<span class="sd">        If True, applies pan sharpening to the RGB bands using the 15m-resolution panchromatic band (B8).</span>
<span class="sd">        Only applicable when `use_sr=False`. Raises ValueError if used with SR products.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloud masking is based on the QA_PIXEL band, using bit flags defined by USGS:</span>
<span class="sd">    - Applied to both TOA and SR products when `use_cloud_mask=True`</span>
<span class="sd">    - For TOA collections, an additional filter (`remove_l_toa_tough_clouds`) is applied</span>
<span class="sd">    to remove low-quality observations based on a simple cloud scoring method.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | Landsat 9 OLI-2/TIRS-2 |</span>
<span class="sd">    | Sensor                     | OLI-2 + TIRS-2         |</span>
<span class="sd">    | Platform                   | Landsat 9              |</span>
<span class="sd">    | Temporal Resolution        | 16 days                |</span>
<span class="sd">    | Pixel Size                 | 30 meters              |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | Product     | Start Date | End Date  |</span>
<span class="sd">    +-------------+------------+------------+</span>
<span class="sd">    | TOA         | 2021-11-01 | present   |</span>
<span class="sd">    | SR          | 2021-11-01 | present   |</span>
<span class="sd">    +-------------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | Band Name | TOA Name | SR Name   | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>
<span class="sd">    | blue      | B2       | SR_B2     | 450-515 nm             |</span>
<span class="sd">    | green     | B3       | SR_B3     | 525-600 nm             |</span>
<span class="sd">    | red       | B4       | SR_B4     | 630-680 nm             |</span>
<span class="sd">    | nir       | B5       | SR_B5     | 845-885 nm             |</span>
<span class="sd">    | swir1     | B6       | SR_B6     | 1560-1660 nm           |</span>
<span class="sd">    | swir2     | B7       | SR_B7     | 2100-2300 nm           |</span>
<span class="sd">    | pan       | B8       |          | 520-900 nm (panchromatic) |</span>
<span class="sd">    +-----------+----------+-----------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Landsat 9 TOA Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T1_TOA</span>

<span class="sd">    - Landsat 9 TOA Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T2_TOA</span>

<span class="sd">    - Landsat 9 SR Collection (Tier 1):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T1_L2</span>

<span class="sd">    - Landsat 9 SR Collection (Tier 2):</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC09_C02_T2_L2</span>

<span class="sd">    - Cloud mask reference (QA_PIXEL flags):</span>
<span class="sd">        https://www.usgs.gov/media/files/landsat-collection-2-pixel-quality-assessment</span>

<span class="sd">    - TOA cloud filtering (Simple Cloud Score):</span>
<span class="sd">        https://developers.google.com/earth-engine/guides/landsat?hl=pt-br#simple-cloud-score</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_sr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tier</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">toa_cloud_filter_strength</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
        <span class="n">use_pan_sharpening</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span> <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;B6&quot;</span><span class="p">,</span> <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;B7&quot;</span><span class="p">,</span> <span class="s2">&quot;pan&quot;</span><span class="p">:</span> <span class="s2">&quot;B8&quot;</span><span class="p">}</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;SR_B7&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
            <span class="n">sensor_code</span><span class="o">=</span><span class="s2">&quot;LC09&quot;</span><span class="p">,</span>
            <span class="n">toa_band_map</span><span class="o">=</span><span class="n">toa</span><span class="p">,</span>
            <span class="n">sr_band_map</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">short_base</span><span class="o">=</span><span class="s2">&quot;l9&quot;</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2021-11-01&quot;</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2050-01-01&quot;</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">use_sr</span><span class="o">=</span><span class="n">use_sr</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
            <span class="n">use_cloud_mask</span><span class="o">=</span><span class="n">use_cloud_mask</span><span class="p">,</span>
            <span class="n">min_valid_pixel_count</span><span class="o">=</span><span class="n">min_valid_pixel_count</span><span class="p">,</span>
            <span class="n">toa_cloud_filter_strength</span><span class="o">=</span><span class="n">toa_cloud_filter_strength</span><span class="p">,</span>
            <span class="n">border_pixels_to_erode</span><span class="o">=</span><span class="n">border_pixels_to_erode</span><span class="p">,</span>
            <span class="n">min_area_to_keep_border</span><span class="o">=</span><span class="n">min_area_to_keep_border</span><span class="p">,</span>
            <span class="n">use_pan_sharpening</span><span class="o">=</span><span class="n">use_pan_sharpening</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.MapBiomas" class="doc doc-heading">
            <code>MapBiomas</code>


<a href="#agrigee_lite.sat.MapBiomas" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.DataSourceSatellite">DataSourceSatellite</span></code></p>


        <p>Satellite abstraction for MapBiomas Brazil Collection 10 Land Use and Land Cover (LULC) data.</p>
<p>This class wraps the official MapBiomas Collection 10 LULC classification product for Brazil.
The dataset provides annual land use and land cover classifications from 1985 to 2023 at 30-meter resolution,
with majority class (<code>10_class</code>) and percent agreement (<code>11_percent</code>) bands.</p>
<p>It is suitable for long-term land cover trend analysis, ecosystem monitoring, and environmental assessments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of border pixels (in pixels) to erode from the input geometry before analysis.
Helps remove classification noise from edges. Use 0 to disable.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area in square meters to retain the eroded region.
Used to avoid discarding small geometries entirely.</p>
              </div>
            </td>
            <td>
                  <code>50000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="bands" open>
  <summary>Bands</summary>
  <p>+-------------+------------------------+-------------------------------------------------------------+
| Band Name   | Type                   | Description                                                 |
+-------------+------------------------+-------------------------------------------------------------+
| 10_class    | Categorical (int)      | Most frequent land use/cover class for the pixel/year       |
| 11_percent  | Float (0-1)            | Proportion of classification votes for the majority class   |
+-------------+------------------------+-------------------------------------------------------------+</p>
</details>

<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.Each integer value in the `10_class` band corresponds to a LULC class defined by MapBiomas.">Each integer value in the `10_class` band corresponds to a LULC class defined by MapBiomas.</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.Refer to `self.classes` for full label and color mapping. Examples include:">Refer to `self.classes` for full label and color mapping. Examples include:</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 3: Forest Formation">- 3: Forest Formation</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 14: Farming">- 14: Farming</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 24: Urban Area">- 24: Urban Area</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 26: Water">- 26: Water</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 39: Soybean">- 39: Soybean</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.MapBiomas.- 46: Coffee">- 46: Coffee</span></code></td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-overview" open>
  <summary>Processing Overview</summary>
  <ol>
<li>The MapBiomas classification image (<code>mapbiomas_brazil_collection10_coverage_v2</code>) is loaded.</li>
<li>For each year between the start and end date of the input feature:</li>
<li>The modal (most frequent) class is computed (<code>10_class</code>)</li>
<li>Its pixel agreement (% of pixels matching that class) is calculated (<code>11_percent</code>)</li>
<li>Optionally, the geometry is eroded to avoid edge noise.</li>
<li>Final features are returned as an annual time series of LULC summaries.</li>
</ol>
</details>

<details class="dataset-information" open>
  <summary>Dataset Information</summary>
  <p>+-------------------------+------------------------------------------------------+
| Field                   | Value                                                |
+-------------------------+------------------------------------------------------+
| Dataset                 | MapBiomas Brazil Collection 10                       |
| Temporal Coverage       | 1985 - 2023                                          |
| Spatial Resolution      | 30 meters                                            |
| Projection              | EPSG: 4674 (SIRGAS 2000)                             |
| Source Imagery          | Landsat (TM, ETM+, OLI)                              |
| Classification Method   | Random Forest + Temporal Filtering                   |
+-------------------------+------------------------------------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Official MapBiomas dataset (Earth Engine):
https://developers.google.com/earth-engine/datasets/catalog/projects_mapbiomas-public_assets_brazil_lulc_collection10_mapbiomas_brazil_collection10_coverage_v2</p>
</li>
<li>
<p>ATBD (Algorithm Theoretical Basis Document) Collection 10:
https://mapbiomas.org/downloads?cama_set_language=en</p>
</li>
<li>
<p>Only the majority class (<code>classification_YEAR</code>) is used here  secondary confidence or transitions are not included.</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/mapbiomas.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MapBiomas</span><span class="p">(</span><span class="n">DataSourceSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for MapBiomas Brazil Collection 10 Land Use and Land Cover (LULC) data.</span>

<span class="sd">    This class wraps the official MapBiomas Collection 10 LULC classification product for Brazil.</span>
<span class="sd">    The dataset provides annual land use and land cover classifications from 1985 to 2023 at 30-meter resolution,</span>
<span class="sd">    with majority class (`10_class`) and percent agreement (`11_percent`) bands.</span>

<span class="sd">    It is suitable for long-term land cover trend analysis, ecosystem monitoring, and environmental assessments.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of border pixels (in pixels) to erode from the input geometry before analysis.</span>
<span class="sd">        Helps remove classification noise from edges. Use 0 to disable.</span>
<span class="sd">    min_area_to_keep_border : int, default=50000</span>
<span class="sd">        Minimum area in square meters to retain the eroded region.</span>
<span class="sd">        Used to avoid discarding small geometries entirely.</span>

<span class="sd">    Bands</span>
<span class="sd">    -----</span>
<span class="sd">    +-------------+------------------------+-------------------------------------------------------------+</span>
<span class="sd">    | Band Name   | Type                   | Description                                                 |</span>
<span class="sd">    +-------------+------------------------+-------------------------------------------------------------+</span>
<span class="sd">    | 10_class    | Categorical (int)      | Most frequent land use/cover class for the pixel/year       |</span>
<span class="sd">    | 11_percent  | Float (0-1)            | Proportion of classification votes for the majority class   |</span>
<span class="sd">    +-------------+------------------------+-------------------------------------------------------------+</span>

<span class="sd">    Classes</span>
<span class="sd">    -------</span>
<span class="sd">    Each integer value in the `10_class` band corresponds to a LULC class defined by MapBiomas.</span>
<span class="sd">    Refer to `self.classes` for full label and color mapping. Examples include:</span>
<span class="sd">    - 3: Forest Formation</span>
<span class="sd">    - 14: Farming</span>
<span class="sd">    - 24: Urban Area</span>
<span class="sd">    - 26: Water</span>
<span class="sd">    - 39: Soybean</span>
<span class="sd">    - 46: Coffee</span>

<span class="sd">    Processing Overview</span>
<span class="sd">    -------------------</span>
<span class="sd">    1. The MapBiomas classification image (`mapbiomas_brazil_collection10_coverage_v2`) is loaded.</span>
<span class="sd">    2. For each year between the start and end date of the input feature:</span>
<span class="sd">    - The modal (most frequent) class is computed (`10_class`)</span>
<span class="sd">    - Its pixel agreement (% of pixels matching that class) is calculated (`11_percent`)</span>
<span class="sd">    3. Optionally, the geometry is eroded to avoid edge noise.</span>
<span class="sd">    4. Final features are returned as an annual time series of LULC summaries.</span>

<span class="sd">    Dataset Information</span>
<span class="sd">    -------------------</span>
<span class="sd">    +-------------------------+------------------------------------------------------+</span>
<span class="sd">    | Field                   | Value                                                |</span>
<span class="sd">    +-------------------------+------------------------------------------------------+</span>
<span class="sd">    | Dataset                 | MapBiomas Brazil Collection 10                       |</span>
<span class="sd">    | Temporal Coverage       | 1985 - 2023                                          |</span>
<span class="sd">    | Spatial Resolution      | 30 meters                                            |</span>
<span class="sd">    | Projection              | EPSG: 4674 (SIRGAS 2000)                             |</span>
<span class="sd">    | Source Imagery          | Landsat (TM, ETM+, OLI)                              |</span>
<span class="sd">    | Classification Method   | Random Forest + Temporal Filtering                   |</span>
<span class="sd">    +-------------------------+------------------------------------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Official MapBiomas dataset (Earth Engine):</span>
<span class="sd">    https://developers.google.com/earth-engine/datasets/catalog/projects_mapbiomas-public_assets_brazil_lulc_collection10_mapbiomas_brazil_collection10_coverage_v2</span>

<span class="sd">    - ATBD (Algorithm Theoretical Basis Document) Collection 10:</span>
<span class="sd">    https://mapbiomas.org/downloads?cama_set_language=en</span>

<span class="sd">    - Only the majority class (`classification_YEAR`) is used here  secondary confidence or transitions are not included.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageAsset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;projects/mapbiomas-public/assets/brazil/lulc/collection10/mapbiomas_brazil_collection10_coverage_v2&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span> <span class="o">=</span> <span class="s2">&quot;1985-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span> <span class="o">=</span> <span class="s2">&quot;2024-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="o">=</span> <span class="s2">&quot;mapbiomasmajclass&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;10_class&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;11_percent&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#1f8d49&quot;</span><span class="p">},</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Forest Formation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#1f8d49&quot;</span><span class="p">},</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Savanna Formation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#7dc975&quot;</span><span class="p">},</span>
            <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Mangrove&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#04381d&quot;</span><span class="p">},</span>
            <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Floodable Forest&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#007785&quot;</span><span class="p">},</span>
            <span class="mi">9</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Forest Plantation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#7a5900&quot;</span><span class="p">},</span>
            <span class="mi">10</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Herbaceous and Shrubby Vegetation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d6bc74&quot;</span><span class="p">},</span>
            <span class="mi">11</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Wetland&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#519799&quot;</span><span class="p">},</span>
            <span class="mi">12</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Grassland&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d6bc74&quot;</span><span class="p">},</span>
            <span class="mi">14</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Farming&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffefc3&quot;</span><span class="p">},</span>
            <span class="mi">15</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pasture&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#edde8e&quot;</span><span class="p">},</span>
            <span class="mi">18</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Agriculture&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#E974ED&quot;</span><span class="p">},</span>
            <span class="mi">19</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Temporary Crop&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#C27BA0&quot;</span><span class="p">},</span>
            <span class="mi">20</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Sugar cane&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#db7093&quot;</span><span class="p">},</span>
            <span class="mi">21</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Mosaic of Uses&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffefc3&quot;</span><span class="p">},</span>
            <span class="mi">22</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Non vegetated area&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d4271e&quot;</span><span class="p">},</span>
            <span class="mi">23</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Beach, Dune and Sand Spot&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffa07a&quot;</span><span class="p">},</span>
            <span class="mi">24</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Urban Area&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d4271e&quot;</span><span class="p">},</span>
            <span class="mi">25</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Other non Vegetated Areas&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#db4d4f&quot;</span><span class="p">},</span>
            <span class="mi">26</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Water&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2532e4&quot;</span><span class="p">},</span>
            <span class="mi">27</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Not Observed&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">},</span>
            <span class="mi">29</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rocky Outcrop&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffaa5f&quot;</span><span class="p">},</span>
            <span class="mi">30</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Mining&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#9c0027&quot;</span><span class="p">},</span>
            <span class="mi">31</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Aquaculture&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#091077&quot;</span><span class="p">},</span>
            <span class="mi">32</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Hypersaline Tidal Flat&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#fc8114&quot;</span><span class="p">},</span>
            <span class="mi">33</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;River, Lake and Ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#2532e4&quot;</span><span class="p">},</span>
            <span class="mi">35</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Palm Oil&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#9065d0&quot;</span><span class="p">},</span>
            <span class="mi">36</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Perennial Crop&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d082de&quot;</span><span class="p">},</span>
            <span class="mi">39</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Soybean&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#f5b3c8&quot;</span><span class="p">},</span>
            <span class="mi">40</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rice&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#c71585&quot;</span><span class="p">},</span>
            <span class="mi">41</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Other Temporary Crops&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#f54ca9&quot;</span><span class="p">},</span>
            <span class="mi">46</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffee&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#d68fe2&quot;</span><span class="p">},</span>
            <span class="mi">47</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Citrus&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#9932cc&quot;</span><span class="p">},</span>
            <span class="mi">48</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Other Perennial Crops&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#e6ccff&quot;</span><span class="p">},</span>
            <span class="mi">49</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Wooded Sandbank Vegetation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#02d659&quot;</span><span class="p">},</span>
            <span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Herbaceous Sandbank Vegetation&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ad5100&quot;</span><span class="p">},</span>
            <span class="mi">62</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Cotton (beta)&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ff69b4&quot;</span><span class="p">},</span>
            <span class="mi">75</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Photovoltaic Power Plant (beta)&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;#c12100&quot;</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;10_class&quot;</span><span class="p">,</span> <span class="s2">&quot;11_percent&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">mb_image</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageAsset</span><span class="p">)</span>
        <span class="n">mb_image</span> <span class="o">=</span> <span class="n">ee_map_valid_pixels</span><span class="p">(</span><span class="n">mb_image</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">)</span>

        <span class="n">ee_start</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ee_end</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">ee_start</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">ee_end</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
        <span class="n">indexnum</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="n">years</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">List</span><span class="o">.</span><span class="n">sequence</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_feat_for_year</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">:</span>
            <span class="n">year_num</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">toInt</span><span class="p">()</span>
            <span class="n">year_str</span> <span class="o">=</span> <span class="n">year_num</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
            <span class="n">band_in</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s2">&quot;classification_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">year_str</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">mb_image</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">band_in</span><span class="p">],</span> <span class="p">[</span><span class="n">year_str</span><span class="p">])</span>

            <span class="n">mode_dict</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mode</span><span class="p">(),</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">maxPixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">clazz</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">mode_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year_str</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

            <span class="n">percent</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">img</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">clazz</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                    <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                    <span class="n">maxPixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                    <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year_str</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">year_str</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;-01-01&quot;</span><span class="p">)</span>

            <span class="n">stats</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;00_indexnum&quot;</span><span class="p">:</span> <span class="n">indexnum</span><span class="p">,</span>
                    <span class="s2">&quot;01_timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                    <span class="s2">&quot;10_class&quot;</span><span class="p">:</span> <span class="n">clazz</span><span class="p">,</span>
                    <span class="s2">&quot;11_percent&quot;</span><span class="p">:</span> <span class="n">percent</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;99_validPixelsCount&quot;</span><span class="p">,</span> <span class="n">mb_image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ZZ_USER_VALID_PIXELS&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">stats</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">years</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_feat_for_year</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Modis8Days" class="doc doc-heading">
            <code>Modis8Days</code>


<a href="#agrigee_lite.sat.Modis8Days" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code></p>


        <p>Satellite abstraction for MODIS Terra and Aqua (8-day composites).</p>
<p>MODIS (Moderate Resolution Imaging Spectroradiometer) is a key instrument aboard NASA's Terra and Aqua satellites,
providing global coverage for land, ocean, and atmospheric monitoring at frequent intervals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to select. Defaults to ['red', 'nir'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of spectral indices to compute from selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply a cloud mask based on the QA 'State' band (bits 0-1).
If True, only pixels with cloud state == 0 (clear) are retained.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>190_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloudy pixels are masked using bits 0-1 of the 'State' QA band, which encode cloud state:
    - 00: clear
    - 01: cloudy
    - 10: mixed
    - 11: not set</p>
<p>The masking keeps only pixels with value 00 (clear) if <code>use_cloud_mask=True</code>.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | MODIS (8-day)          |
| Platforms                  | Terra, Aqua            |
| Temporal Resolution        | 8 days                 |
| Pixel Size                 | 250 meters             |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+--------+------------+------------+
| Source | Start Date | End Date  |
+--------+------------+------------+
| Terra  | 2000-02-18 | present   |
| Aqua   | 2002-07-04 | present   |
+--------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------------+----------------+------------------------+
| Band Name | Original Band  | Resolution     | Spectral Wavelength    |
+-----------+----------------+----------------+------------------------+
| red       | sur_refl_b01   | 250 meters     | 620-670 nm             |
| nir       | sur_refl_b02   | 250 meters     | 841-876 nm             |
+-----------+----------------+----------------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>Cloud Mask Reference (QA 'State' band documentation):
    https://lpdaac.usgs.gov/documents/925/MOD09_User_Guide_V61.pdf</p>
<p>MODIS Collections on Google Earth Engine:
    - Terra (MOD09Q1): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09Q1
    - Aqua  (MYD09Q1): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09Q1</p>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/modis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Modis8Days</span><span class="p">(</span><span class="n">OpticalSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for MODIS Terra and Aqua (8-day composites).</span>

<span class="sd">    MODIS (Moderate Resolution Imaging Spectroradiometer) is a key instrument aboard NASA&#39;s Terra and Aqua satellites,</span>
<span class="sd">    providing global coverage for land, ocean, and atmospheric monitoring at frequent intervals.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : list of str, optional</span>
<span class="sd">        List of bands to select. Defaults to [&#39;red&#39;, &#39;nir&#39;].</span>
<span class="sd">    indices : list of str, optional</span>
<span class="sd">        List of spectral indices to compute from selected bands.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply a cloud mask based on the QA &#39;State&#39; band (bits 0-1).</span>
<span class="sd">        If True, only pixels with cloud state == 0 (clear) are retained.</span>
<span class="sd">    min_valid_pixel_count : int, default=2</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=0.5</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=190_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloudy pixels are masked using bits 0-1 of the &#39;State&#39; QA band, which encode cloud state:</span>
<span class="sd">        - 00: clear</span>
<span class="sd">        - 01: cloudy</span>
<span class="sd">        - 10: mixed</span>
<span class="sd">        - 11: not set</span>

<span class="sd">    The masking keeps only pixels with value 00 (clear) if `use_cloud_mask=True`.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | MODIS (8-day)          |</span>
<span class="sd">    | Platforms                  | Terra, Aqua            |</span>
<span class="sd">    | Temporal Resolution        | 8 days                 |</span>
<span class="sd">    | Pixel Size                 | 250 meters             |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +--------+------------+------------+</span>
<span class="sd">    | Source | Start Date | End Date  |</span>
<span class="sd">    +--------+------------+------------+</span>
<span class="sd">    | Terra  | 2000-02-18 | present   |</span>
<span class="sd">    | Aqua   | 2002-07-04 | present   |</span>
<span class="sd">    +--------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>
<span class="sd">    | Band Name | Original Band  | Resolution     | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>
<span class="sd">    | red       | sur_refl_b01   | 250 meters     | 620-670 nm             |</span>
<span class="sd">    | nir       | sur_refl_b02   | 250 meters     | 841-876 nm             |</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Cloud Mask Reference (QA &#39;State&#39; band documentation):</span>
<span class="sd">        https://lpdaac.usgs.gov/documents/925/MOD09_User_Guide_V61.pdf</span>

<span class="sd">    MODIS Collections on Google Earth Engine:</span>
<span class="sd">        - Terra (MOD09Q1): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09Q1</span>
<span class="sd">        - Aqua  (MYD09Q1): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09Q1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">190_000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">})</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="o">=</span> <span class="s2">&quot;modis8days&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span> <span class="o">=</span> <span class="s2">&quot;2000-02-18&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_terra</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MOD09Q1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aqua</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MYD09Q1&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;sur_refl_b01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;sur_refl_b02&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableIndices</span><span class="p">[</span><span class="n">indice_name</span><span class="p">],</span> <span class="n">indice_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">indice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indice_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useCloudMask</span> <span class="o">=</span> <span class="n">use_cloud_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mask_modis8days_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mask cloudy pixels based on bits 0-1 of &#39;State&#39; QA band.&quot;&quot;&quot;</span>
        <span class="n">qa</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">)</span>
        <span class="n">cloud_state</span> <span class="o">=</span> <span class="n">qa</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3 == 0b11</span>
        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">cloud_state</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">),</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_base</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useCloudMask</span><span class="p">:</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_modis8days_clouds</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="n">terra</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terra</span><span class="p">)</span>
        <span class="n">aqua</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aqua</span><span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aqua</span><span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">16_100</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
            <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span>
            <span class="n">modis_imgc</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">modis_imgc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">190_000</span><span class="p">)</span>
        <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>

        <span class="n">modis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">feats</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">feats</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="agrigee_lite.sat.Modis8Days._mask_modis8days_clouds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_mask_modis8days_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#agrigee_lite.sat.Modis8Days._mask_modis8days_clouds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mask cloudy pixels based on bits 0-1 of 'State' QA band.</p>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/sat/modis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_mask_modis8days_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask cloudy pixels based on bits 0-1 of &#39;State&#39; QA band.&quot;&quot;&quot;</span>
    <span class="n">qa</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">)</span>
    <span class="n">cloud_state</span> <span class="o">=</span> <span class="n">qa</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3 == 0b11</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">cloud_state</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.ModisDaily" class="doc doc-heading">
            <code>ModisDaily</code>


<a href="#agrigee_lite.sat.ModisDaily" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code></p>


        <p>  Note: Despite this cloud mask, daily MODIS imagery tends to have <strong>a high presence of residual clouds</strong>. It is recommended to use Modis8Days for cleaner data. </p>
<p>Satellite abstraction for MODIS Terra and Aqua (Daily composites).</p>
<p>MODIS (Moderate Resolution Imaging Spectroradiometer) is a key instrument aboard NASA's Terra and Aqua satellites,
offering daily global coverage for environmental and land surface monitoring.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['red', 'nir'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of spectral indices to compute from selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cloud_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply cloud masking using bit 10 of the 'state_1km' QA band.
When set to False, no cloud filtering is applied (results may be ULTRA NOISY).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>190_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="cloud-masking" open>
  <summary>Cloud Masking</summary>
  <p>Cloudy pixels are masked using bit 10 of the 'state_1km' QA band:
    - 0: clear
    - 1: cloudy</p>
<p>Only pixels with bit 10 equal to 0 (clear) are retained.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+------------------------+
| Field                      | Value                  |
+----------------------------+------------------------+
| Name                       | MODIS (Daily)          |
| Platforms                  | Terra, Aqua            |
| Temporal Resolution        | 1 day                  |
| Pixel Size                 | 250 meters             |
| Coverage                   | Global                 |
+----------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+--------+------------+------------+
| Source | Start Date | End Date  |
+--------+------------+------------+
| Terra  | 2000-02-24 | present   |
| Aqua   | 2002-07-04 | present   |
+--------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+----------------+----------------+------------------------+
| Band Name | Original Band  | Resolution     | Spectral Wavelength    |
+-----------+----------------+----------------+------------------------+
| red       | sur_refl_b01   | 250 meters     | 620-670 nm             |
| nir       | sur_refl_b02   | 250 meters     | 841-876 nm             |
+-----------+----------------+----------------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>Cloud Mask Reference (QA 'state_1km' band documentation):
    https://lpdaac.usgs.gov/documents/925/MOD09_User_Guide_V61.pdf</p>
<p>MODIS Collections on Google Earth Engine:
    - Terra (MOD09GQ - reflectance): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09GQ
    - Terra (MOD09GA - QA band):     https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09GA
    - Aqua  (MYD09GQ - reflectance): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09GQ
    - Aqua  (MYD09GA - QA band):     https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09GA</p>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/modis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ModisDaily</span><span class="p">(</span><span class="n">OpticalSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Note: Despite this cloud mask, daily MODIS imagery tends to have **a high presence of residual clouds**. It is recommended to use Modis8Days for cleaner data. </span>

<span class="sd">    Satellite abstraction for MODIS Terra and Aqua (Daily composites).</span>

<span class="sd">    MODIS (Moderate Resolution Imaging Spectroradiometer) is a key instrument aboard NASA&#39;s Terra and Aqua satellites,</span>
<span class="sd">    offering daily global coverage for environmental and land surface monitoring.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;red&#39;, &#39;nir&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        List of spectral indices to compute from selected bands.</span>
<span class="sd">    use_cloud_mask : bool, default=True</span>
<span class="sd">        Whether to apply cloud masking using bit 10 of the &#39;state_1km&#39; QA band.</span>
<span class="sd">        When set to False, no cloud filtering is applied (results may be ULTRA NOISY).</span>
<span class="sd">    min_valid_pixel_count : int, default=2</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=0.5</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=190_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Cloud Masking</span>
<span class="sd">    -------------</span>
<span class="sd">    Cloudy pixels are masked using bit 10 of the &#39;state_1km&#39; QA band:</span>
<span class="sd">        - 0: clear</span>
<span class="sd">        - 1: cloudy</span>

<span class="sd">    Only pixels with bit 10 equal to 0 (clear) are retained.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Field                      | Value                  |</span>
<span class="sd">    +----------------------------+------------------------+</span>
<span class="sd">    | Name                       | MODIS (Daily)          |</span>
<span class="sd">    | Platforms                  | Terra, Aqua            |</span>
<span class="sd">    | Temporal Resolution        | 1 day                  |</span>
<span class="sd">    | Pixel Size                 | 250 meters             |</span>
<span class="sd">    | Coverage                   | Global                 |</span>
<span class="sd">    +----------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +--------+------------+------------+</span>
<span class="sd">    | Source | Start Date | End Date  |</span>
<span class="sd">    +--------+------------+------------+</span>
<span class="sd">    | Terra  | 2000-02-24 | present   |</span>
<span class="sd">    | Aqua   | 2002-07-04 | present   |</span>
<span class="sd">    +--------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>
<span class="sd">    | Band Name | Original Band  | Resolution     | Spectral Wavelength    |</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>
<span class="sd">    | red       | sur_refl_b01   | 250 meters     | 620-670 nm             |</span>
<span class="sd">    | nir       | sur_refl_b02   | 250 meters     | 841-876 nm             |</span>
<span class="sd">    +-----------+----------------+----------------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Cloud Mask Reference (QA &#39;state_1km&#39; band documentation):</span>
<span class="sd">        https://lpdaac.usgs.gov/documents/925/MOD09_User_Guide_V61.pdf</span>

<span class="sd">    MODIS Collections on Google Earth Engine:</span>
<span class="sd">        - Terra (MOD09GQ - reflectance): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09GQ</span>
<span class="sd">        - Terra (MOD09GA - QA band):     https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD09GA</span>
<span class="sd">        - Aqua  (MYD09GQ - reflectance): https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09GQ</span>
<span class="sd">        - Aqua  (MYD09GA - QA band):     https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MYD09GA</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_cloud_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">190_000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">})</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="o">=</span> <span class="s2">&quot;modis&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span> <span class="o">=</span> <span class="s2">&quot;2000-02-24&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_vis</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MOD09GQ&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terra_qa</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MOD09GA&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aqua_vis</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MYD09GQ&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aqua_qa</span> <span class="o">=</span> <span class="s2">&quot;MODIS/061/MYD09GA&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;sur_refl_b01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;sur_refl_b02&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableIndices</span><span class="p">[</span><span class="n">indice_name</span><span class="p">],</span> <span class="n">indice_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">indice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indice_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useCloudMask</span> <span class="o">=</span> <span class="n">use_cloud_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mask_modis_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Bit-test bit 10 of *state_1km* (value 0 = clear).&quot;&quot;&quot;</span>
        <span class="n">qa</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;state_1km&quot;</span><span class="p">)</span>
        <span class="n">bit_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">qa</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="n">bit_mask</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the merged, cloud-masked Terra + Aqua collection *exactly*</span>
<span class="sd">        like the stand-alone helper did.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">),</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_base</span><span class="p">(</span><span class="n">vis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">qa</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span><span class="o">.</span><span class="n">linkCollection</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">qa</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;state_1km&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useCloudMask</span><span class="p">:</span>
                <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_modis_clouds</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="n">terra</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terra_vis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_qa</span><span class="p">)</span>
        <span class="n">aqua</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aqua_vis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aqua_qa</span><span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aqua</span><span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">16_100</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
            <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span>
            <span class="n">modis_imgc</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">modis_imgc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">modis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">feats</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">feats</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="agrigee_lite.sat.ModisDaily._mask_modis_clouds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_mask_modis_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#agrigee_lite.sat.ModisDaily._mask_modis_clouds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Bit-test bit 10 of <em>state_1km</em> (value 0 = clear).</p>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/sat/modis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_mask_modis_clouds</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bit-test bit 10 of *state_1km* (value 0 = clear).&quot;&quot;&quot;</span>
    <span class="n">qa</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;state_1km&quot;</span><span class="p">)</span>
    <span class="n">bit_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">qa</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="n">bit_mask</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="agrigee_lite.sat.ModisDaily.imageCollection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span></code>

<a href="#agrigee_lite.sat.ModisDaily.imageCollection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Build the merged, cloud-masked Terra + Aqua collection <em>exactly</em>
like the stand-alone helper did.</p>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/sat/modis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the merged, cloud-masked Terra + Aqua collection *exactly*</span>
<span class="sd">    like the stand-alone helper did.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
    <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
        <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span>
        <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">),</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_base</span><span class="p">(</span><span class="n">vis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">qa</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span><span class="o">.</span><span class="n">linkCollection</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">qa</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;state_1km&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useCloudMask</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_modis_clouds</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">collection</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="p">)</span>

    <span class="n">terra</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terra_vis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terra_qa</span><span class="p">)</span>
    <span class="n">aqua</span> <span class="o">=</span> <span class="n">_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aqua_vis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aqua_qa</span><span class="p">)</span>

    <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aqua</span><span class="p">)</span>

    <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">16_100</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
        <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">modis_imgc</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">modis_imgc</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span>
        <span class="n">modis_imgc</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">modis_imgc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.PALSAR2ScanSAR" class="doc doc-heading">
            <code>PALSAR2ScanSAR</code>


<a href="#agrigee_lite.sat.PALSAR2ScanSAR" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.RadarSatellite">RadarSatellite</span></code></p>


        <p>Satellite abstraction for ALOS PALSAR-2 ScanSAR (Level 2.2).</p>
<p>PALSAR-2 is an L-band Synthetic Aperture Radar (SAR) sensor onboard the ALOS-2 satellite,
operated by JAXA. This class provides preprocessing and abstraction for the Level 2.2
ScanSAR data product with 25-meter resolution. Optionally applies the MSK quality mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of bands to select. Defaults to ['hh', 'hv'].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radar indices to compute (e.g., polarization ratios). Defaults to [].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_quality_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply the MSK bitmask quality filter. If False, all pixels are retained,
including those marked as low-quality or invalid.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>35_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="quality-masking" open>
  <summary>Quality Masking</summary>
  <p>When <code>use_quality_mask=True</code>, the <code>MSK</code> band is used to filter out invalid pixels.
The first 3 bits of the <code>MSK</code> band indicate data quality:
    - 1  Valid
    - 5  Invalid
Only pixels with value 1 are retained.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+----------------------------+-------------------------------+
| Field                      | Value                         |
+----------------------------+-------------------------------+
| Name                       | ALOS PALSAR-2 ScanSAR         |
| Sensor                     | PALSAR-2 (L-band SAR)         |
| Platform                   | ALOS-2                        |
| Revisit Time               | ~14 days                      |
| Pixel Size                 | ~25 meters                    |
| Coverage                   | Japan + selected global areas |
+----------------------------+-------------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+----------------+-------------+------------+
| Collection     | Start Date  | End Date   |
+----------------+-------------+------------+
| Level 2.2      | 2014-08-04  | present    |
+----------------+-------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+---------+------------+-------------------------------------------+
| Band Name | Type    | Resolution | Description                               |
+-----------+---------+------------+-------------------------------------------+
| hh        | L-band  | ~25 m      | Horizontal transmit and receive           |
| hv        | L-band  | ~25 m      | Horizontal transmit, vertical receive     |
| msk       | Bitmask | ~25 m      | MSK quality band (used only if enabled)   |
+-----------+---------+------------+-------------------------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Earth Engine Dataset:
    https://developers.google.com/earth-engine/datasets/catalog/JAXA_ALOS_PALSAR-2_Level2_2_ScanSAR</p>
</li>
<li>
<p>MSK Quality Mask Details (bit pattern):
    https://www.eorc.jaxa.jp/ALOS/en/palsar_fnf/data/Format_PALSAR-2.html</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/palsar.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PALSAR2ScanSAR</span><span class="p">(</span><span class="n">RadarSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for ALOS PALSAR-2 ScanSAR (Level 2.2).</span>

<span class="sd">    PALSAR-2 is an L-band Synthetic Aperture Radar (SAR) sensor onboard the ALOS-2 satellite,</span>
<span class="sd">    operated by JAXA. This class provides preprocessing and abstraction for the Level 2.2</span>
<span class="sd">    ScanSAR data product with 25-meter resolution. Optionally applies the MSK quality mask.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of bands to select. Defaults to [&#39;hh&#39;, &#39;hv&#39;].</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Radar indices to compute (e.g., polarization ratios). Defaults to [].</span>
<span class="sd">    use_quality_mask : bool, default=True</span>
<span class="sd">        Whether to apply the MSK bitmask quality filter. If False, all pixels are retained,</span>
<span class="sd">        including those marked as low-quality or invalid.</span>
<span class="sd">    min_valid_pixel_count : int, default=20</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=35_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Quality Masking</span>
<span class="sd">    ---------------</span>
<span class="sd">    When `use_quality_mask=True`, the `MSK` band is used to filter out invalid pixels.</span>
<span class="sd">    The first 3 bits of the `MSK` band indicate data quality:</span>
<span class="sd">        - 1  Valid</span>
<span class="sd">        - 5  Invalid</span>
<span class="sd">    Only pixels with value 1 are retained.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +----------------------------+-------------------------------+</span>
<span class="sd">    | Field                      | Value                         |</span>
<span class="sd">    +----------------------------+-------------------------------+</span>
<span class="sd">    | Name                       | ALOS PALSAR-2 ScanSAR         |</span>
<span class="sd">    | Sensor                     | PALSAR-2 (L-band SAR)         |</span>
<span class="sd">    | Platform                   | ALOS-2                        |</span>
<span class="sd">    | Revisit Time               | ~14 days                      |</span>
<span class="sd">    | Pixel Size                 | ~25 meters                    |</span>
<span class="sd">    | Coverage                   | Japan + selected global areas |</span>
<span class="sd">    +----------------------------+-------------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +----------------+-------------+------------+</span>
<span class="sd">    | Collection     | Start Date  | End Date   |</span>
<span class="sd">    +----------------+-------------+------------+</span>
<span class="sd">    | Level 2.2      | 2014-08-04  | present    |</span>
<span class="sd">    +----------------+-------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+---------+------------+-------------------------------------------+</span>
<span class="sd">    | Band Name | Type    | Resolution | Description                               |</span>
<span class="sd">    +-----------+---------+------------+-------------------------------------------+</span>
<span class="sd">    | hh        | L-band  | ~25 m      | Horizontal transmit and receive           |</span>
<span class="sd">    | hv        | L-band  | ~25 m      | Horizontal transmit, vertical receive     |</span>
<span class="sd">    | msk       | Bitmask | ~25 m      | MSK quality band (used only if enabled)   |</span>
<span class="sd">    +-----------+---------+------------+-------------------------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Earth Engine Dataset:</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/JAXA_ALOS_PALSAR-2_Level2_2_ScanSAR</span>

<span class="sd">    - MSK Quality Mask Details (bit pattern):</span>
<span class="sd">        https://www.eorc.jaxa.jp/ALOS/en/palsar_fnf/data/Format_PALSAR-2.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_quality_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="s2">&quot;hh&quot;</span><span class="p">,</span> <span class="s2">&quot;hv&quot;</span><span class="p">})</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;JAXA/ALOS/PALSAR-2/Level2_2/ScanSAR&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2014-08-04&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;palsar2&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hh&quot;</span><span class="p">:</span> <span class="s2">&quot;HH&quot;</span><span class="p">,</span> <span class="s2">&quot;hv&quot;</span><span class="p">:</span> <span class="s2">&quot;HV&quot;</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableIndices</span><span class="p">[</span><span class="n">indice_name</span><span class="p">],</span> <span class="n">indice_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">indice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indice_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_quality_mask</span> <span class="o">=</span> <span class="n">use_quality_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mask_quality</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply MSK quality mask to exclude invalid data.</span>

<span class="sd">        MSK bits 0-2 indicate data quality:</span>
<span class="sd">            1 = valid data</span>
<span class="sd">            5 = invalid</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        img : ee.Image</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ee.Image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MSK&quot;</span><span class="p">)</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="mb">0b111</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">quality</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">ee_start</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ee_end</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>

        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_start</span><span class="p">,</span> <span class="n">ee_end</span><span class="p">))</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_quality_mask</span><span class="p">:</span>
            <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_quality</span><span class="p">)</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">],</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">log10</span><span class="p">()</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="mi">83</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
            <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span><span class="n">palsar_img</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">palsar_img</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">palsar_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">palsar_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="agrigee_lite.sat.PALSAR2ScanSAR._mask_quality" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_mask_quality</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#agrigee_lite.sat.PALSAR2ScanSAR._mask_quality" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply MSK quality mask to exclude invalid data.</p>
<p>MSK bits 0-2 indicate data quality:
    1 = valid data
    5 = invalid</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="ee.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ee.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/sat/palsar.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_mask_quality</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply MSK quality mask to exclude invalid data.</span>

<span class="sd">    MSK bits 0-2 indicate data quality:</span>
<span class="sd">        1 = valid data</span>
<span class="sd">        5 = invalid</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    img : ee.Image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ee.Image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MSK&quot;</span><span class="p">)</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">bitwiseAnd</span><span class="p">(</span><span class="mb">0b111</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">quality</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.SatelliteEmbedding" class="doc doc-heading">
            <code>SatelliteEmbedding</code>


<a href="#agrigee_lite.sat.SatelliteEmbedding" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.DataSourceSatellite">DataSourceSatellite</span></code></p>


        <p>Satellite abstraction for the Google Satellite Embedding collection.</p>
<p>This collection contains annual, manually curated embeddings derived from multi-sensor satellite data.</p>
<p>IMPORTANT: It always returns the center point value as the median (in order to maintain z-sphere normalization) and the standard deviation of the geometry without the borders.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to select. Defaults to all 64 embeddings.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-eroded) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>35_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+-----------------------------+-----------------------+
| Field                       | Value                 |
+-----------------------------+-----------------------+
| Name                        | Satellite Embedding   |
| Embedding Dimensions        | 64 (A0 to A63)        |
| Pixel Size                  | ~10 meters            |
| Temporal Resolution         | Annual                |
| Coverage                    | Global                |
+-----------------------------+-----------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+------------+------------+
| Start Date | End Date   |
+------------+------------+
| 2017-01-01 | 2024-01-02 |
+------------+------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>Satellite Embedding V1:
    - Dataset: https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_SATELLITE_EMBEDDING_V1_ANNUAL?hl=pt-br#bands</p>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/embeddings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SatelliteEmbedding</span><span class="p">(</span><span class="n">DataSourceSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for the Google Satellite Embedding collection.</span>

<span class="sd">    This collection contains annual, manually curated embeddings derived from multi-sensor satellite data.</span>

<span class="sd">    IMPORTANT: It always returns the center point value as the median (in order to maintain z-sphere normalization) and the standard deviation of the geometry without the borders.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : list of str, optional</span>
<span class="sd">        List of bands to select. Defaults to all 64 embeddings.</span>
<span class="sd">    min_valid_pixel_count : int, default=1</span>
<span class="sd">        Minimum number of valid (non-eroded) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=35_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +-----------------------------+-----------------------+</span>
<span class="sd">    | Field                       | Value                 |</span>
<span class="sd">    +-----------------------------+-----------------------+</span>
<span class="sd">    | Name                        | Satellite Embedding   |</span>
<span class="sd">    | Embedding Dimensions        | 64 (A0 to A63)        |</span>
<span class="sd">    | Pixel Size                  | ~10 meters            |</span>
<span class="sd">    | Temporal Resolution         | Annual                |</span>
<span class="sd">    | Coverage                    | Global                |</span>
<span class="sd">    +-----------------------------+-----------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +------------+------------+</span>
<span class="sd">    | Start Date | End Date   |</span>
<span class="sd">    +------------+------------+</span>
<span class="sd">    | 2017-01-01 | 2024-01-02 |</span>
<span class="sd">    +------------+------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------------</span>
<span class="sd">    Satellite Embedding V1:</span>
<span class="sd">        - Dataset: https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_SATELLITE_EMBEDDING_V1_ANNUAL?hl=pt-br#bands</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;A</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GOOGLE/SATELLITE_EMBEDDING/V1/ANNUAL&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2017-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2024-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;satembed&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">ee_start</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ee_end</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>

        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_start</span><span class="p">,</span> <span class="n">ee_end</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">imgcol</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">imgcol</span> <span class="o">=</span> <span class="n">imgcol</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural</span> <span class="k">for</span> <span class="n">natural</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">],</span>
            <span class="p">[</span><span class="n">renamed</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">renamed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">imgcol</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span><span class="n">imgcol</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">imgcol</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">imgcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">compute_stats</span><span class="p">(</span>
            <span class="n">ee_img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span> <span class="n">pixel_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">:</span>
            <span class="n">ee_img</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ee_img</span><span class="p">)</span>

            <span class="n">median</span> <span class="o">=</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">first</span><span class="p">(),</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">centroid</span><span class="p">(</span><span class="mf">0.001</span><span class="p">),</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
                <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">stddev</span> <span class="o">=</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">stdDev</span><span class="p">(),</span>
                <span class="n">geometry</span><span class="o">=</span><span class="n">ee_geometry</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
                <span class="n">maxPixels</span><span class="o">=</span><span class="n">subsampling_max_pixels</span><span class="p">,</span>
                <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">stddev</span> <span class="o">=</span> <span class="n">stddev</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">stddev</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">stddev</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_stdDev&quot;</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">median</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">median</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">median</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_median&quot;</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">props</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">median</span><span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">stddev</span><span class="p">)</span>

            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;00_indexnum&quot;</span><span class="p">,</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;01_timestamp&quot;</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">ee_img</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;YYYY-MM-dd&quot;</span><span class="p">))</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;99_validPixelsCount&quot;</span><span class="p">,</span> <span class="n">ee_img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ZZ_USER_VALID_PIXELS&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">imgcol</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">compute_stats</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Sentinel1GRD" class="doc doc-heading">
            <code>Sentinel1GRD</code>


<a href="#agrigee_lite.sat.Sentinel1GRD" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.RadarSatellite">RadarSatellite</span></code></p>




<details class="-sentinel-1-availability-warning" open>
  <summary> Sentinel-1 Availability Warning</summary>
  <p>Due to the failure of the Sentinel-1B satellite in December 2021, the constellation has been operating solely
with Sentinel-1A. This has led to reduced data availability in many regions  particularly in the Southern
Hemisphere  with revisit times increasing from ~6 days to ~12 days or more. Some areas may experience
significant temporal gaps, especially after early 2022. </p>
<p>Satellite abstraction for Sentinel-1 Ground Range Detected (GRD) product.</p>
<p>Sentinel-1 is a constellation of two polar-orbiting satellites (Sentinel-1A and 1B)
operated by ESA, equipped with C-band Synthetic Aperture Radar (SAR). It provides
all-weather, day-and-night imaging of Earth's surface.</p>
<p>This class wraps the Sentinel-1 GRD product and allows users to select polarizations,
filter by orbit pass, and apply edge masks to remove low-backscatter areas (e.g., layover).</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of polarizations to select. Defaults to {'vv', 'vh'}.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>set of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of radar indices (e.g. ratios). Defaults to [].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ascending</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, selects ASCENDING orbit passes. If False, selects DESCENDING.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_edge_mask</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply an edge mask to remove extreme low-backscatter areas
(commonly occurring near the edges of acquisitions or in layover/shadow zones).
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>35_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="edge-masking" open>
  <summary>Edge Masking</summary>
  <p>Sentinel-1 radar images often contain low-backscatter areas near image borders or over layover zones.
This class applies a threshold-based edge mask (<code>&lt; -30 dB</code>) to reduce artifacts.</p>
</details>

<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+-------------------------------+-------------------------------+
| Field                         | Value                         |
+-------------------------------+-------------------------------+
| Name                          | Sentinel-1                    |
| Agency                        | ESA (Copernicus)              |
| Instrument                    | C-band Synthetic Aperture Radar (SAR) |
| Revisit Time (full mission)   | ~6 days (1A + 1B constellation)|
| Revisit Time (post-2021)      | ~12 days (only 1A active)     |
| Orbit Type                    | Sun-synchronous (polar)       |
| Pixel Size                    | ~10 meters                    |
| Coverage                      | Global                        |
+-------------------------------+-------------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+------------------+-------------+-----------+
| Product          | Start Date  | End Date  |
+------------------+-------------+-----------+
| GRD              | 2014-10-03  | present   |
+------------------+-------------+-----------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+------------+-----------+-------------+------------------------------+
| Band Name  | Frequency | Resolution  | Description                  |
+------------+-----------+-------------+------------------------------+
| VV         | 5.405 GHz | ~10 meters  | Vertical transmit/receive    |
| VH         | 5.405 GHz | ~10 meters  | Vertical transmit, horizontal receive |
+------------+-----------+-------------+------------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>
<p>Official GRD collection (Earth Engine):
  https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S1_GRD</p>
</li>
<li>
<p>Sentinel-1 User Guide:
  https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar</p>
</li>
<li>
<p>Orbit direction filter:
  https://developers.google.com/earth-engine/sentinel1#orbit-direction</p>
</li>
</ul>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/sentinel1.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Sentinel1GRD</span><span class="p">(</span><span class="n">RadarSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Sentinel-1 Availability Warning</span>
<span class="sd">    ---------------------------------</span>
<span class="sd">    Due to the failure of the Sentinel-1B satellite in December 2021, the constellation has been operating solely</span>
<span class="sd">    with Sentinel-1A. This has led to reduced data availability in many regions  particularly in the Southern</span>
<span class="sd">    Hemisphere  with revisit times increasing from ~6 days to ~12 days or more. Some areas may experience</span>
<span class="sd">    significant temporal gaps, especially after early 2022. </span>

<span class="sd">    Satellite abstraction for Sentinel-1 Ground Range Detected (GRD) product.</span>

<span class="sd">    Sentinel-1 is a constellation of two polar-orbiting satellites (Sentinel-1A and 1B)</span>
<span class="sd">    operated by ESA, equipped with C-band Synthetic Aperture Radar (SAR). It provides</span>
<span class="sd">    all-weather, day-and-night imaging of Earth&#39;s surface.</span>

<span class="sd">    This class wraps the Sentinel-1 GRD product and allows users to select polarizations,</span>
<span class="sd">    filter by orbit pass, and apply edge masks to remove low-backscatter areas (e.g., layover).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : set of str, optional</span>
<span class="sd">        Set of polarizations to select. Defaults to {&#39;vv&#39;, &#39;vh&#39;}.</span>
<span class="sd">    indices : set of str, optional</span>
<span class="sd">        Set of radar indices (e.g. ratios). Defaults to [].</span>
<span class="sd">    ascending : bool, default=True</span>
<span class="sd">        If True, selects ASCENDING orbit passes. If False, selects DESCENDING.</span>
<span class="sd">    use_edge_mask : bool, optional</span>
<span class="sd">        Whether to apply an edge mask to remove extreme low-backscatter areas</span>
<span class="sd">        (commonly occurring near the edges of acquisitions or in layover/shadow zones).</span>
<span class="sd">        Default is True.</span>
<span class="sd">    min_valid_pixel_count : int, default=20</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=35_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Edge Masking</span>
<span class="sd">    ------------</span>
<span class="sd">    Sentinel-1 radar images often contain low-backscatter areas near image borders or over layover zones.</span>
<span class="sd">    This class applies a threshold-based edge mask (`&lt; -30 dB`) to reduce artifacts.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +-------------------------------+-------------------------------+</span>
<span class="sd">    | Field                         | Value                         |</span>
<span class="sd">    +-------------------------------+-------------------------------+</span>
<span class="sd">    | Name                          | Sentinel-1                    |</span>
<span class="sd">    | Agency                        | ESA (Copernicus)              |</span>
<span class="sd">    | Instrument                    | C-band Synthetic Aperture Radar (SAR) |</span>
<span class="sd">    | Revisit Time (full mission)   | ~6 days (1A + 1B constellation)|</span>
<span class="sd">    | Revisit Time (post-2021)      | ~12 days (only 1A active)     |</span>
<span class="sd">    | Orbit Type                    | Sun-synchronous (polar)       |</span>
<span class="sd">    | Pixel Size                    | ~10 meters                    |</span>
<span class="sd">    | Coverage                      | Global                        |</span>
<span class="sd">    +-------------------------------+-------------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +------------------+-------------+-----------+</span>
<span class="sd">    | Product          | Start Date  | End Date  |</span>
<span class="sd">    +------------------+-------------+-----------+</span>
<span class="sd">    | GRD              | 2014-10-03  | present   |</span>
<span class="sd">    +------------------+-------------+-----------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +------------+-----------+-------------+------------------------------+</span>
<span class="sd">    | Band Name  | Frequency | Resolution  | Description                  |</span>
<span class="sd">    +------------+-----------+-------------+------------------------------+</span>
<span class="sd">    | VV         | 5.405 GHz | ~10 meters  | Vertical transmit/receive    |</span>
<span class="sd">    | VH         | 5.405 GHz | ~10 meters  | Vertical transmit, horizontal receive |</span>
<span class="sd">    +------------+-----------+-------------+------------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Official GRD collection (Earth Engine):</span>
<span class="sd">      https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S1_GRD</span>

<span class="sd">    - Sentinel-1 User Guide:</span>
<span class="sd">      https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar</span>

<span class="sd">    - Orbit direction filter:</span>
<span class="sd">      https://developers.google.com/earth-engine/sentinel1#orbit-direction</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_edge_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="s2">&quot;vv&quot;</span><span class="p">,</span> <span class="s2">&quot;vh&quot;</span><span class="p">})</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ascending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">ascending</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_edge_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">use_edge_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;COPERNICUS/S1_GRD&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="c1"># full mission start (S-1A launch)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2014-10-03&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s1a&quot;</span> <span class="k">if</span> <span class="n">ascending</span> <span class="k">else</span> <span class="s2">&quot;s1d&quot;</span>

        <span class="c1"># original  product band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vv&quot;</span><span class="p">:</span> <span class="s2">&quot;VV&quot;</span><span class="p">,</span> <span class="s2">&quot;vh&quot;</span><span class="p">:</span> <span class="s2">&quot;VH&quot;</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableIndices</span><span class="p">[</span><span class="n">indice_name</span><span class="p">],</span> <span class="n">indice_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">indice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indice_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mask_edge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove extreme low-backscatter areas (edges / layover)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        img : ee.Image</span>
<span class="sd">            Unfiltered Sentinel-1 image</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ee.Image</span>
<span class="sd">            Filtered Sentinel-1 image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">edge</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="o">-</span><span class="mf">30.0</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">Not</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">ee_start</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ee_end</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>

        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_start</span><span class="p">,</span> <span class="n">ee_end</span><span class="p">))</span>

        <span class="n">polarization_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">listContains</span><span class="p">(</span><span class="s2">&quot;transmitterReceiverPolarisation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span>
        <span class="p">])</span>

        <span class="n">orbit_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">&quot;orbitProperties_pass&quot;</span><span class="p">,</span> <span class="s2">&quot;ASCENDING&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ascending</span> <span class="k">else</span> <span class="s2">&quot;DESCENDING&quot;</span><span class="p">)</span>

        <span class="n">s1_img</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">polarization_filter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">orbit_filter</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_edge_mask</span><span class="p">:</span>
            <span class="n">s1_img</span> <span class="o">=</span> <span class="n">s1_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_edge</span><span class="p">)</span>

        <span class="n">s1_img</span> <span class="o">=</span> <span class="n">s1_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
            <span class="n">s1_img</span> <span class="o">=</span> <span class="n">s1_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">s1_img</span> <span class="o">=</span> <span class="n">s1_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">s1_img</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span><span class="n">s1_img</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">s1_img</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">s1_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">s1_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="agrigee_lite.sat.Sentinel1GRD._mask_edge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_mask_edge</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#agrigee_lite.sat.Sentinel1GRD._mask_edge" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove extreme low-backscatter areas (edges / layover)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="ee.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unfiltered Sentinel-1 image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ee.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtered Sentinel-1 image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>agrigee_lite/sat/sentinel1.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_mask_edge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove extreme low-backscatter areas (edges / layover)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    img : ee.Image</span>
<span class="sd">        Unfiltered Sentinel-1 image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ee.Image</span>
<span class="sd">        Filtered Sentinel-1 image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">edge</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="o">-</span><span class="mf">30.0</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">Not</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.Sentinel2" class="doc doc-heading">
            <code>Sentinel2</code>


<a href="#agrigee_lite.sat.Sentinel2" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code></p>


        <p>Satellite abstraction for Sentinel-2 (HARMONIZED collections).</p>
<p>Sentinel-2 is a constellation of twin Earth observation satellites,
operated by ESA, designed for land monitoring, vegetation, soil, water cover, and coastal areas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bands</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of bands to select. Defaults to all 10 bands most used for vegetation and soil analysis.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indices</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of spectral indices to compute from the selected bands.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_sr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, uses surface reflectance (BOA, 'S2_SR_HARMONIZED').
If False, uses top-of-atmosphere reflectance ('S2_HARMONIZED').</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cloud_probability_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum threshold to consider a pixel as cloud-free.</p>
              </div>
            </td>
            <td>
                  <code>0.7</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_valid_pixel_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of valid (non-cloud) pixels required to retain an image.</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>border_pixels_to_erode</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pixels to erode from the geometry border.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_area_to_keep_border</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum area (in m) required to retain geometry after border erosion.</p>
              </div>
            </td>
            <td>
                  <code>35_000</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="satellite-information" open>
  <summary>Satellite Information</summary>
  <p>+------------------------------------+------------------------+
| Field                              | Value                  |
+------------------------------------+------------------------+
| Name                               | Sentinel-2             |
| Revisit Time                       | 5 days                 |
| Revisit Time (cloud-free estimate) | ~7 days                |
| Pixel Size                         | 10 meters              |
| Coverage                           | Global                 |
+------------------------------------+------------------------+</p>
</details>

<details class="collection-dates" open>
  <summary>Collection Dates</summary>
  <p>+----------------------------+------------+------------+
| Collection Type            | Start Date | End Date  |
+----------------------------+------------+------------+
| TOA (Top of Atmosphere)    | 2016-01-01 | present   |
| SR (Surface Reflectance)   | 2019-01-01 | present   |
+----------------------------+------------+------------+</p>
</details>

<details class="band-information" open>
  <summary>Band Information</summary>
  <p>+-----------+---------------+--------------+------------------------+
| Band Name | Original Band | Resolution   | Spectral Wavelength    |
+-----------+---------------+--------------+------------------------+
| blue      | B2            | 10 m         | 492 nm                 |
| green     | B3            | 10 m         | 559 nm                 |
| red       | B4            | 10 m         | 665 nm                 |
| re1       | B5            | 20 m         | 704 nm                 |
| re2       | B6            | 20 m         | 739 nm                 |
| re3       | B7            | 20 m         | 780 nm                 |
| nir       | B8            | 10 m         | 833 nm                 |
| re4       | B8A           | 20 m         | 864 nm                 |
| swir1     | B11           | 20 m         | 1610 nm                |
| swir2     | B12           | 20 m         | 2186 nm                |
+-----------+---------------+--------------+------------------------+</p>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>Cloud Masking:
    This class uses the <strong>Cloud Score Plus</strong> dataset to estimate cloud probability:
    https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_CLOUD_SCORE_PLUS_V1_S2_HARMONIZED</p>
<p>Sentinel-2 Collections:
    - TOA: https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_HARMONIZED
    - SR:  https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR_HARMONIZED</p>
</details>





              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/sentinel2.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Sentinel2</span><span class="p">(</span><span class="n">OpticalSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Satellite abstraction for Sentinel-2 (HARMONIZED collections).</span>

<span class="sd">    Sentinel-2 is a constellation of twin Earth observation satellites,</span>
<span class="sd">    operated by ESA, designed for land monitoring, vegetation, soil, water cover, and coastal areas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bands : list of str, optional</span>
<span class="sd">        List of bands to select. Defaults to all 10 bands most used for vegetation and soil analysis.</span>
<span class="sd">    indices : list of str, optional</span>
<span class="sd">        List of spectral indices to compute from the selected bands.</span>
<span class="sd">    use_sr : bool, default=True</span>
<span class="sd">        If True, uses surface reflectance (BOA, &#39;S2_SR_HARMONIZED&#39;).</span>
<span class="sd">        If False, uses top-of-atmosphere reflectance (&#39;S2_HARMONIZED&#39;).</span>
<span class="sd">    cloud_probability_threshold : float, default=0.7</span>
<span class="sd">        Minimum threshold to consider a pixel as cloud-free.</span>
<span class="sd">    min_valid_pixel_count : int, default=20</span>
<span class="sd">        Minimum number of valid (non-cloud) pixels required to retain an image.</span>
<span class="sd">    border_pixels_to_erode : float, default=1</span>
<span class="sd">        Number of pixels to erode from the geometry border.</span>
<span class="sd">    min_area_to_keep_border : int, default=35_000</span>
<span class="sd">        Minimum area (in m) required to retain geometry after border erosion.</span>

<span class="sd">    Satellite Information</span>
<span class="sd">    ---------------------</span>
<span class="sd">    +------------------------------------+------------------------+</span>
<span class="sd">    | Field                              | Value                  |</span>
<span class="sd">    +------------------------------------+------------------------+</span>
<span class="sd">    | Name                               | Sentinel-2             |</span>
<span class="sd">    | Revisit Time                       | 5 days                 |</span>
<span class="sd">    | Revisit Time (cloud-free estimate) | ~7 days                |</span>
<span class="sd">    | Pixel Size                         | 10 meters              |</span>
<span class="sd">    | Coverage                           | Global                 |</span>
<span class="sd">    +------------------------------------+------------------------+</span>

<span class="sd">    Collection Dates</span>
<span class="sd">    ----------------</span>
<span class="sd">    +----------------------------+------------+------------+</span>
<span class="sd">    | Collection Type            | Start Date | End Date  |</span>
<span class="sd">    +----------------------------+------------+------------+</span>
<span class="sd">    | TOA (Top of Atmosphere)    | 2016-01-01 | present   |</span>
<span class="sd">    | SR (Surface Reflectance)   | 2019-01-01 | present   |</span>
<span class="sd">    +----------------------------+------------+------------+</span>

<span class="sd">    Band Information</span>
<span class="sd">    ----------------</span>
<span class="sd">    +-----------+---------------+--------------+------------------------+</span>
<span class="sd">    | Band Name | Original Band | Resolution   | Spectral Wavelength    |</span>
<span class="sd">    +-----------+---------------+--------------+------------------------+</span>
<span class="sd">    | blue      | B2            | 10 m         | 492 nm                 |</span>
<span class="sd">    | green     | B3            | 10 m         | 559 nm                 |</span>
<span class="sd">    | red       | B4            | 10 m         | 665 nm                 |</span>
<span class="sd">    | re1       | B5            | 20 m         | 704 nm                 |</span>
<span class="sd">    | re2       | B6            | 20 m         | 739 nm                 |</span>
<span class="sd">    | re3       | B7            | 20 m         | 780 nm                 |</span>
<span class="sd">    | nir       | B8            | 10 m         | 833 nm                 |</span>
<span class="sd">    | re4       | B8A           | 20 m         | 864 nm                 |</span>
<span class="sd">    | swir1     | B11           | 20 m         | 1610 nm                |</span>
<span class="sd">    | swir2     | B12           | 20 m         | 2186 nm                |</span>
<span class="sd">    +-----------+---------------+--------------+------------------------+</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------------</span>
<span class="sd">    Cloud Masking:</span>
<span class="sd">        This class uses the **Cloud Score Plus** dataset to estimate cloud probability:</span>
<span class="sd">        https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_CLOUD_SCORE_PLUS_V1_S2_HARMONIZED</span>

<span class="sd">    Sentinel-2 Collections:</span>
<span class="sd">        - TOA: https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_HARMONIZED</span>
<span class="sd">        - SR:  https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR_HARMONIZED</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_sr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">cloud_probability_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="n">min_valid_pixel_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">border_pixels_to_erode</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">min_area_to_keep_border</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">35000</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">sorted</span><span class="p">({</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;re1&quot;</span><span class="p">,</span> <span class="s2">&quot;re2&quot;</span><span class="p">,</span> <span class="s2">&quot;re3&quot;</span><span class="p">,</span> <span class="s2">&quot;nir&quot;</span><span class="p">,</span> <span class="s2">&quot;re4&quot;</span><span class="p">,</span> <span class="s2">&quot;swir1&quot;</span><span class="p">,</span> <span class="s2">&quot;swir2&quot;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useSr</span> <span class="o">=</span> <span class="n">use_sr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span> <span class="o">=</span> <span class="s2">&quot;COPERNICUS/S2_SR_HARMONIZED&quot;</span> <span class="k">if</span> <span class="n">use_sr</span> <span class="k">else</span> <span class="s2">&quot;COPERNICUS/S2_HARMONIZED&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span> <span class="k">if</span> <span class="n">use_sr</span> <span class="k">else</span> <span class="s2">&quot;2016-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2050-01-01&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s2sr&quot;</span> <span class="k">if</span> <span class="n">use_sr</span> <span class="k">else</span> <span class="s2">&quot;s2&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;re1&quot;</span><span class="p">:</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;re2&quot;</span><span class="p">:</span> <span class="s2">&quot;B6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;re3&quot;</span><span class="p">:</span> <span class="s2">&quot;B7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;B8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;re4&quot;</span><span class="p">:</span> <span class="s2">&quot;B8A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir1&quot;</span><span class="p">:</span> <span class="s2">&quot;B11&quot;</span><span class="p">,</span>
            <span class="s2">&quot;swir2&quot;</span><span class="p">:</span> <span class="s2">&quot;B12&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">band</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableIndices</span><span class="p">[</span><span class="n">indice_name</span><span class="p">],</span> <span class="n">indice_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">indice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indice_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cloudProbabilityThreshold</span> <span class="o">=</span> <span class="n">cloud_probability_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span> <span class="o">=</span> <span class="n">min_valid_pixel_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span> <span class="o">=</span> <span class="n">min_area_to_keep_border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">=</span> <span class="n">border_pixels_to_erode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="n">ee_start_date</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ee_end_date</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>

        <span class="n">ee_filter</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">),</span> <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">ee_start_date</span><span class="p">,</span> <span class="n">ee_end_date</span><span class="p">))</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageCollectionName</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availableBands</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">:</span>
            <span class="n">s2_img</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">ee_add_indexes_to_image</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="p">[</span><span class="n">natural_band_name</span> <span class="k">for</span> <span class="n">natural_band_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">indice_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numeral_band_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_band_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedBands</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">numeral_indice_name</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">numeral_indice_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedIndices</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">s2_cloud_mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="s2">&quot;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee_filter</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;cs_cdf&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;cloud&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">s2_cloud_mask</span><span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="n">ee_cloud_probability_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudProbabilityThreshold</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">s2_img</span> <span class="o">=</span> <span class="n">ee_filter_img_collection_invalid_pixels</span><span class="p">(</span><span class="n">s2_img</span><span class="p">,</span> <span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minValidPixelCount</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">s2_img</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span>
                <span class="n">ee_geometry</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">borderPixelsToErode</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minAreaToKeepBorder</span>
            <span class="p">)</span>
            <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="agrigee_lite.sat.TwoSatelliteFusion" class="doc doc-heading">
            <code>TwoSatelliteFusion</code>


<a href="#agrigee_lite.sat.TwoSatelliteFusion" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code></p>


        <p>A satellite fusion class that combines data from exactly two optical satellites for synchronized analysis.</p>
<p>This class enables the fusion of data from two different optical satellites by finding
common observation dates and merging their image collections. It ensures temporal alignment
between the two satellite datasets, making it possible to perform comparative analysis or
create composite datasets from dual satellite sources.</p>
<p>The class is specifically designed for two-satellite fusion and automatically handles:
- Temporal intersection calculation between the two satellite date ranges
- Spatial resolution alignment using the finest available resolution
- Band renaming with prefixes to distinguish between the two satellite sources
- Image collection synchronization based on common observation dates
- Unified processing pipeline for both satellite datasets</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>satellite_a</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first optical satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite_b</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second optical satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.sat_a">sat_a</span></code></td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the first satellite object.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.sat_b">sat_b</span></code></td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.OpticalSatellite">OpticalSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the second satellite object.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.startDate">startDate</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latest start date between both satellites (ISO format).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.endDate">endDate</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The earliest end date between both satellites (ISO format).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.pixelSize">pixelSize</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The finest spatial resolution between both satellites.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.shortName">shortName</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined short name identifier for the fused satellite configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="agrigee_lite.sat.TwoSatelliteFusion.toDownloadSelectors">toDownloadSelectors</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Combined selectors from both satellites with distinguishing prefixes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">agrigee_lite.sat.landsat</span><span class="w"> </span><span class="kn">import</span> <span class="n">Landsat8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">agrigee_lite.sat.sentinel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sentinel2</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l8</span> <span class="o">=</span> <span class="n">Landsat8</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="n">Sentinel2</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fusion</span> <span class="o">=</span> <span class="n">TwoSatelliteFusion</span><span class="p">(</span><span class="n">l8</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The fused satellite will only cover the temporal overlap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fusion</span><span class="o">.</span><span class="n">startDate</span><span class="p">)</span>  <span class="c1"># Latest of the two start dates</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fusion</span><span class="o">.</span><span class="n">endDate</span><span class="p">)</span>    <span class="c1"># Earliest of the two end dates</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>agrigee_lite/sat/unified_satellite.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TwoSatelliteFusion</span><span class="p">(</span><span class="n">OpticalSatellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A satellite fusion class that combines data from exactly two optical satellites for synchronized analysis.</span>

<span class="sd">    This class enables the fusion of data from two different optical satellites by finding</span>
<span class="sd">    common observation dates and merging their image collections. It ensures temporal alignment</span>
<span class="sd">    between the two satellite datasets, making it possible to perform comparative analysis or</span>
<span class="sd">    create composite datasets from dual satellite sources.</span>

<span class="sd">    The class is specifically designed for two-satellite fusion and automatically handles:</span>
<span class="sd">    - Temporal intersection calculation between the two satellite date ranges</span>
<span class="sd">    - Spatial resolution alignment using the finest available resolution</span>
<span class="sd">    - Band renaming with prefixes to distinguish between the two satellite sources</span>
<span class="sd">    - Image collection synchronization based on common observation dates</span>
<span class="sd">    - Unified processing pipeline for both satellite datasets</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    satellite_a : OpticalSatellite</span>
<span class="sd">        The first optical satellite configuration object.</span>
<span class="sd">    satellite_b : OpticalSatellite</span>
<span class="sd">        The second optical satellite configuration object.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    sat_a : OpticalSatellite</span>
<span class="sd">        Reference to the first satellite object.</span>
<span class="sd">    sat_b : OpticalSatellite</span>
<span class="sd">        Reference to the second satellite object.</span>
<span class="sd">    startDate : str</span>
<span class="sd">        The latest start date between both satellites (ISO format).</span>
<span class="sd">    endDate : str</span>
<span class="sd">        The earliest end date between both satellites (ISO format).</span>
<span class="sd">    pixelSize : float</span>
<span class="sd">        The finest spatial resolution between both satellites.</span>
<span class="sd">    shortName : str</span>
<span class="sd">        Combined short name identifier for the fused satellite configuration.</span>
<span class="sd">    toDownloadSelectors : list[str]</span>
<span class="sd">        Combined selectors from both satellites with distinguishing prefixes.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from agrigee_lite.sat.landsat import Landsat8</span>
<span class="sd">    &gt;&gt;&gt; from agrigee_lite.sat.sentinel import Sentinel2</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; l8 = Landsat8()</span>
<span class="sd">    &gt;&gt;&gt; s2 = Sentinel2()</span>
<span class="sd">    &gt;&gt;&gt; fusion = TwoSatelliteFusion(l8, s2)</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; # The fused satellite will only cover the temporal overlap</span>
<span class="sd">    &gt;&gt;&gt; print(fusion.startDate)  # Latest of the two start dates</span>
<span class="sd">    &gt;&gt;&gt; print(fusion.endDate)    # Earliest of the two end dates</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">satellite_a</span><span class="p">:</span> <span class="n">OpticalSatellite</span><span class="p">,</span> <span class="n">satellite_b</span><span class="p">:</span> <span class="n">OpticalSatellite</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sat_a</span> <span class="o">=</span> <span class="n">satellite_a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sat_b</span> <span class="o">=</span> <span class="n">satellite_b</span>

        <span class="c1"># Get the intersection between start date and end date of both satellites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startDate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">satellite_a</span><span class="o">.</span><span class="n">startDate</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">satellite_b</span><span class="o">.</span><span class="n">startDate</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endDate</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">satellite_a</span><span class="o">.</span><span class="n">endDate</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">satellite_b</span><span class="o">.</span><span class="n">endDate</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">satellite_a</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="n">satellite_b</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fusion_</span><span class="si">{</span><span class="n">satellite_a</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">satellite_b</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toDownloadSelectors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;8</span><span class="si">{</span><span class="n">selector</span><span class="si">}{</span><span class="n">satellite_a</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">satellite_a</span><span class="o">.</span><span class="n">toDownloadSelectors</span>
        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;7</span><span class="si">{</span><span class="n">selector</span><span class="si">}{</span><span class="n">satellite_b</span><span class="o">.</span><span class="n">shortName</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">satellite_b</span><span class="o">.</span><span class="n">toDownloadSelectors</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">imageCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">:</span>
        <span class="n">sat_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_a</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>
        <span class="n">sat_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_b</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">sat_a_dates</span> <span class="o">=</span> <span class="n">extract_dates</span><span class="p">(</span><span class="n">sat_a</span><span class="p">)</span>
        <span class="n">sat_b_dates</span> <span class="o">=</span> <span class="n">extract_dates</span><span class="p">(</span><span class="n">sat_b</span><span class="p">)</span>

        <span class="n">common_dates</span> <span class="o">=</span> <span class="n">intersect_lists</span><span class="p">(</span><span class="n">sat_a_dates</span><span class="p">,</span> <span class="n">sat_b_dates</span><span class="p">)</span>

        <span class="n">sat_a_filtered</span> <span class="o">=</span> <span class="n">filter_by_common_dates</span><span class="p">(</span><span class="n">sat_a</span><span class="p">,</span> <span class="n">common_dates</span><span class="p">)</span>
        <span class="n">sat_b_filtered</span> <span class="o">=</span> <span class="n">filter_by_common_dates</span><span class="p">(</span><span class="n">sat_b</span><span class="p">,</span> <span class="n">common_dates</span><span class="p">)</span>

        <span class="n">sat_a_filtered</span> <span class="o">=</span> <span class="n">rename_bands</span><span class="p">(</span><span class="n">sat_a_filtered</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_a</span><span class="o">.</span><span class="n">shortName</span><span class="p">)</span>
        <span class="n">sat_b_filtered</span> <span class="o">=</span> <span class="n">rename_bands</span><span class="p">(</span><span class="n">sat_b_filtered</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_b</span><span class="o">.</span><span class="n">shortName</span><span class="p">)</span>

        <span class="n">merged</span> <span class="o">=</span> <span class="n">sat_a_filtered</span><span class="o">.</span><span class="n">linkCollection</span><span class="p">(</span>
            <span class="n">sat_b_filtered</span><span class="p">,</span> <span class="n">matchPropertyName</span><span class="o">=</span><span class="s2">&quot;ZZ_USER_TIME_DUMMY&quot;</span><span class="p">,</span> <span class="n">linkedBands</span><span class="o">=</span><span class="n">sat_b_filtered</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">merged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ee_feature</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">,</span>
        <span class="n">subsampling_max_pixels</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">reducers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">:</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="n">ee_geometry</span> <span class="o">=</span> <span class="n">ee_safe_remove_borders</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span> <span class="mi">35000</span><span class="p">)</span>
        <span class="n">ee_feature</span> <span class="o">=</span> <span class="n">ee_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">)</span>

        <span class="n">s2_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageCollection</span><span class="p">(</span><span class="n">ee_feature</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">s2_img</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="n">ee_map_bands_and_doy</span><span class="p">,</span>
                <span class="n">ee_feature</span><span class="o">=</span><span class="n">ee_feature</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">,</span>
                <span class="n">subsampling_max_pixels</span><span class="o">=</span><span class="n">ee_get_number_of_pixels</span><span class="p">(</span><span class="n">ee_geometry</span><span class="p">,</span> <span class="n">subsampling_max_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelSize</span><span class="p">),</span>
                <span class="n">reducer</span><span class="o">=</span><span class="n">ee_get_reducers</span><span class="p">(</span><span class="n">reducers</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">features</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sat_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_a</span><span class="o">.</span><span class="n">log_dict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sat_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sat_b</span><span class="o">.</span><span class="n">log_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="agrigee_lite.vis"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="agrigee_lite.vis.multiple_sits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multiple_sits</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">band_or_indice_to_plot</span><span class="p">,</span> <span class="n">reducer</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

<a href="#agrigee_lite.vis.multiple_sits" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Visualize satellite time series for multiple geometries with normalized temporal alignment.</p>
<p>Creates overlaid line plots for multiple geometries, with time series normalized
to year fractions to enable comparison across different years. Each geometry's
time series is plotted as a semi-transparent line, making it easy to identify
patterns and outliers across the dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing multiple geometries and their temporal information.
Must have the required date columns for satellite time series processing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>satellite</code>
            </td>
            <td>
                  <code><span title="agrigee_lite.sat.abstract_satellite.AbstractSatellite">AbstractSatellite</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Satellite configuration object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>band_or_indice_to_plot</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the band or vegetation index to visualize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reducer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporal reducer to apply (e.g., "median", "mean"), by default "median".</p>
              </div>
            </td>
            <td>
                  <code>&#39;median&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td>
                  <code><span title="matplotlib.axes.Axes">Axes</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matplotlib axes object for plotting. If None, creates a new plot, by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>color</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Color for the plot lines, by default "blue".</p>
              </div>
            </td>
            <td>
                  <code>&#39;blue&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transparency level for individual lines (0.0 to 1.0), by default 0.5.
Lower values help visualize overlapping time series.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The function creates a plot but doesn't return any value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This function normalizes timestamps to year fractions, where each time series
starts from 0.0, making it possible to overlay multiple years of data for
pattern analysis. The original timestamps are converted using the <code>year_fraction</code>
function and then normalized to start from zero.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>agrigee_lite/vis/sits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visualize_multiple_sits</span><span class="p">(</span>
    <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">satellite</span><span class="p">:</span> <span class="n">AbstractSatellite</span><span class="p">,</span>
    <span class="n">band_or_indice_to_plot</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">reducer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize satellite time series for multiple geometries with normalized temporal alignment.</span>

<span class="sd">    Creates overlaid line plots for multiple geometries, with time series normalized</span>
<span class="sd">    to year fractions to enable comparison across different years. Each geometry&#39;s</span>
<span class="sd">    time series is plotted as a semi-transparent line, making it easy to identify</span>
<span class="sd">    patterns and outliers across the dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdf : gpd.GeoDataFrame</span>
<span class="sd">        GeoDataFrame containing multiple geometries and their temporal information.</span>
<span class="sd">        Must have the required date columns for satellite time series processing.</span>
<span class="sd">    satellite : AbstractSatellite</span>
<span class="sd">        Satellite configuration object.</span>
<span class="sd">    band_or_indice_to_plot : str</span>
<span class="sd">        Name of the band or vegetation index to visualize.</span>
<span class="sd">    reducer : str, optional</span>
<span class="sd">        Temporal reducer to apply (e.g., &quot;median&quot;, &quot;mean&quot;), by default &quot;median&quot;.</span>
<span class="sd">    ax : matplotlib.axes.Axes or None, optional</span>
<span class="sd">        Matplotlib axes object for plotting. If None, creates a new plot, by default None.</span>
<span class="sd">    color : str, optional</span>
<span class="sd">        Color for the plot lines, by default &quot;blue&quot;.</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Transparency level for individual lines (0.0 to 1.0), by default 0.5.</span>
<span class="sd">        Lower values help visualize overlapping time series.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function creates a plot but doesn&#39;t return any value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function normalizes timestamps to year fractions, where each time series</span>
<span class="sd">    starts from 0.0, making it possible to overlay multiple years of data for</span>
<span class="sd">    pattern analysis. The original timestamps are converted using the `year_fraction`</span>
<span class="sd">    function and then normalized to start from zero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

    <span class="n">long_sits</span> <span class="o">=</span> <span class="n">download_multiple_sits</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">satellite</span><span class="p">,</span> <span class="n">reducers</span><span class="o">=</span><span class="p">[</span><span class="n">reducer</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">long_sits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">indexnumm</span> <span class="ow">in</span> <span class="n">long_sits</span><span class="o">.</span><span class="n">indexnum</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">indexnumm_df</span> <span class="o">=</span> <span class="n">long_sits</span><span class="p">[</span><span class="n">long_sits</span><span class="o">.</span><span class="n">indexnum</span> <span class="o">==</span> <span class="n">indexnumm</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">indexnumm_df</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indexnumm_df</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">year_fraction</span><span class="p">)</span>
        <span class="n">indexnumm_df</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indexnumm_df</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">indexnumm_df</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">indexnumm_df</span><span class="p">[</span><span class="n">band_or_indice_to_plot</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">indexnumm_df</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">indexnumm_df</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">satellite</span><span class="o">.</span><span class="n">shortName</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://mateuspinto.com">mateuspinto</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/mateuspinto/AgriGEE.lite" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/agrigee_lite" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>